<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Velosify | Neural Study OS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin
        src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@0.263.1/dist/umd/lucide.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-cpp.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');

        body {
            font-family: 'Outfit', sans-serif;
            background-color: #05050a;
            color: #e2e8f0;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        :root {
            --brand-500: 99 102 241;
            --brand-600: 79 70 229;
            --brand-400: 129 140 248;
        }

        .scifi-grid {
            position: fixed;
            width: 200%;
            height: 200%;
            bottom: -50%;
            left: -50%;
            background-image: linear-gradient(rgb(var(--brand-500)/0.15) 1px, transparent 1px), linear-gradient(90deg, rgb(var(--brand-500)/0.15) 1px, transparent 1px);
            background-size: 50px 50px;
            transform: perspective(500px) rotateX(60deg);
            animation: grid-move 30s linear infinite;
            z-index: -2;
            opacity: 0.3;
            mask-image: linear-gradient(to top, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0));
        }

        @keyframes grid-move {
            0% {
                transform: perspective(500px) rotateX(60deg) translateY(0);
            }

            100% {
                transform: perspective(500px) rotateX(60deg) translateY(50px);
            }
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        .holo-card {
            background: rgba(10, 10, 15, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.2), 0 8px 30px rgba(0, 0, 0, 0.4);
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .holo-card:hover {
            border-color: rgba(var(--brand-500), 0.5);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 0 0 1px rgba(var(--brand-500), 0.2), 0 20px 50px rgba(0, 0, 0, 0.5), 0 0 30px rgba(var(--brand-500), 0.1);
        }

        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        .animate-float-delayed {
            animation: float 8s ease-in-out infinite;
            animation-delay: 2s;
        }

        .animate-fade-in {
            animation: fadeIn 0.6s cubic-bezier(0.2, 0.9, 0.2, 1) forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        .delay-100 {
            animation-delay: 100ms;
        }

        .delay-200 {
            animation-delay: 200ms;
        }

        .delay-300 {
            animation-delay: 300ms;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .perspective-1000 {
            perspective: 1000px;
        }

        .transform-style-3d {
            transform-style: preserve-3d;
        }

        .backface-hidden {
            backface-visibility: hidden;
        }

        .rotate-y-180 {
            transform: rotateY(180deg);
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(var(--brand-500), 0.5);
        }

        @keyframes moveGrid {
            0% {
                transform: translateY(0);
            }

            100% {
                transform: translateY(50px);
            }
        }

        @keyframes marquee {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-50%);
            }
        }

        .animate-blink {
            animation: blink 1s step-end infinite;
        }

        @keyframes blink {
            50% {
                opacity: 0;
            }
        }

        .scifi-grid-animated {
            background-image: linear-gradient(rgba(var(--brand-500), 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(var(--brand-500), 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: moveGrid 10s linear infinite;
        }
    </style>
    <script>
        tailwind.config = { darkMode: 'class', theme: { extend: { colors: { brand: { 500: 'rgb(var(--brand-500) / <alpha-value>)', 600: 'rgb(var(--brand-600) / <alpha-value>)', 400: 'rgb(var(--brand-400) / <alpha-value>)' }, surface: { 800: '#1e293b', 900: '#0f172a' } }, fontFamily: { mono: ['JetBrains Mono', 'monospace'] }, animation: { shimmer: 'shimmer 1.5s infinite' }, keyframes: { shimmer: { '100%': { transform: 'translateX(100%)' } } } } } }
    </script>
</head>

<body>
    <div id="boot-screen"
        class="fixed inset-0 z-50 bg-[#05050a] flex flex-col items-center justify-center text-white transition-opacity duration-500">
        <div class="loader mb-6 w-12 h-12 border-2 border-brand-500 border-t-transparent rounded-full animate-spin">
        </div>
        <h2 class="text-xl font-bold tracking-widest">VELOSIFY v2.0</h2>
        <p class="text-[10px] text-brand-400 mt-2 font-mono tracking-[0.3em] opacity-70 animate-pulse">SYSTEM
            INITIALIZATION</p>
    </div>
    <div
        class="fixed top-0 left-0 w-full h-full bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-blue-900/10 via-black to-black pointer-events-none z-[-1]">
    </div>
    <div class="scifi-grid"></div>
    <div id="root"></div>

    <script>
        window.SUPABASE_URL = "https://wgjwgovcarpsvvmwuaww.supabase.co";
        window.SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indnandnb3ZjYXJwc3Z2bXd1YXd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAwNDQ3NTksImV4cCI6MjA4NTYyMDc1OX0.Up0WU1xqUH5ZqAPpz0lVypZrcr9RJOjcMEKwG399f_A";
        window.sb = window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY);
        window.__SESSION__ = null;

        async function boot() {
            try {
                const { data } = await window.sb.auth.getSession();
                window.__SESSION__ = data.session;
                if (window.location.hash?.includes('access_token')) {
                    const { data: { session } } = await window.sb.auth.getSession();
                    window.__SESSION__ = session;
                    window.history.replaceState(null, null, window.location.pathname);
                }
            } catch (e) { console.error("Boot:", e); window.__SESSION__ = null; }
            finally {
                window.dispatchEvent(new Event('velosify-ready'));
                setTimeout(() => { const el = document.getElementById('boot-screen'); el.style.opacity = '0'; setTimeout(() => el.remove(), 500); }, 800);
            }
        }
        boot();
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        /* --- ICONS & UI --- */
        const Icon = ({ name, size = 18, className = "" }) => { useEffect(() => { if (window.lucide) setTimeout(() => window.lucide.createIcons(), 50); }, [name]); return <i data-lucide={name} style={{ width: size, height: size, display: 'inline-block' }} className={className}></i>; };
        const cn = (...c) => c.filter(Boolean).join(" ");
        const Card = ({ children, className = "", onClick }) => <div onClick={onClick} className={cn("holo-card rounded-2xl p-6 relative overflow-hidden group", className)}>{children}</div>;
        const Button = ({ children, onClick, variant = 'primary', className = "", icon = null, type = "button" }) => {
            const v = { primary: "bg-brand-600 text-white hover:bg-brand-500 shadow-[0_0_20px_rgba(var(--brand-500),0.3)]", secondary: "bg-white/5 border border-white/10 hover:bg-white/10 text-slate-200", danger: "bg-red-500/10 text-red-400 border border-red-500/30 hover:bg-red-500/20" };
            return <button type={type} onClick={onClick} className={cn("flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl text-[10px] font-bold transition-all active:scale-95 uppercase tracking-widest", v[variant], className)}>{icon && <Icon name={icon} size={13} />}{children}</button>;
        };

        /* --- AUTH PAGE MODAL --- */
        const AuthModal = ({ onClose }) => {
            const [email, setEmail] = useState(""); const [password, setPassword] = useState(""); const [loading, setLoading] = useState(false); const [errorMsg, setErrorMsg] = useState(null); const [mode, setMode] = useState("signin");
            useEffect(() => { const h = (e) => { if (e.key === 'Escape') onClose(); }; window.addEventListener('keydown', h); return () => window.removeEventListener('keydown', h); }, [onClose]);

            const handleAuth = async (e) => {
                e.preventDefault(); setLoading(true); setErrorMsg(null);
                try {
                    const sb = window.sb;
                    const redirectTo = window.location.origin;
                    if (mode === 'signin') { const { error } = await sb.auth.signInWithPassword({ email, password }); if (error) throw error; }
                    else { const { data, error } = await sb.auth.signUp({ email, password, options: { emailRedirectTo: redirectTo } }); if (error) throw error; if (data.user && !data.session) alert("Check email for confirmation."); }
                    const { data } = await sb.auth.getSession(); if (data.session) window.location.reload();
                } catch (err) { setErrorMsg(String(err?.message || err || "Auth Failed")); } finally { setLoading(false); }
            };
            const handleGoogle = async () => {
                setLoading(true); setErrorMsg(null);
                try {
                    const redirectTo = window.location.origin;
                    const { error } = await window.sb.auth.signInWithOAuth({ provider: 'google', options: { redirectTo } }); if (error) throw error;
                }
                catch (err) { setErrorMsg(String(err?.message || "Google Auth Failed")); setLoading(false); }
            };
            return (
                <div onClick={onClose} className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-fade-in">
                    <div onClick={e => e.stopPropagation()} className="w-full max-w-md holo-card rounded-2xl p-8 border-t border-white/20 relative shadow-[0_0_50px_rgba(var(--brand-500),0.2)]">
                        <button onClick={onClose} className="absolute top-4 right-4 text-slate-500 hover:text-white transition-colors bg-white/5 hover:bg-white/10 p-2 rounded-full"><Icon name="x" size={20} /></button>
                        <div className="text-center mb-10">
                            <div className="w-16 h-16 rounded-2xl bg-gradient-to-br from-brand-500 to-brand-600 flex items-center justify-center text-white font-bold text-3xl shadow-[0_0_30px_rgba(var(--brand-500),0.4)] mx-auto mb-6 animate-pulse">V</div>
                            <h2 className="text-3xl font-extrabold text-white tracking-tight">Velosify</h2>
                            <p className="text-brand-400 text-[10px] font-mono tracking-[0.3em] mt-3 uppercase opacity-80">Identity Verification</p>
                        </div>
                        {errorMsg && <div className="mb-6 bg-red-500/10 border border-red-500/20 rounded-xl p-4 text-red-300 text-xs font-mono">{errorMsg}</div>}
                        <form onSubmit={handleAuth} className="space-y-5">
                            <div className="group relative"><Icon name="mail" size={16} className="absolute left-4 top-3.5 text-slate-500 group-focus-within:text-brand-400" /><input type="email" required value={email} onChange={e => setEmail(e.target.value)} className="w-full bg-black/40 border border-white/10 rounded-xl py-3 pl-11 pr-4 text-sm text-white focus:border-brand-500 focus:ring-1 focus:ring-brand-500 outline-none transition-all placeholder:text-slate-600 font-mono" placeholder="NEURAL ID" /></div>
                            <div className="group relative"><Icon name="lock" size={16} className="absolute left-4 top-3.5 text-slate-500 group-focus-within:text-brand-400" /><input type="password" required value={password} onChange={e => setPassword(e.target.value)} className="w-full bg-black/40 border border-white/10 rounded-xl py-3 pl-11 pr-4 text-sm text-white focus:border-brand-500 focus:ring-1 focus:ring-brand-500 outline-none transition-all placeholder:text-slate-600 font-mono" placeholder="ACCESS CODE" /></div>
                            <button type="submit" disabled={loading} className="w-full bg-brand-600 hover:bg-brand-500 text-white font-bold py-2.5 rounded-xl transition-all shadow-lg shadow-brand-600/20 active:scale-[0.98] uppercase text-[10px] tracking-widest">{loading ? 'PROCESSING...' : (mode === 'signin' ? 'AUTHENTICATE' : 'INITIATE REGISTRATION')}</button>
                        </form>
                        <div className="my-8 flex items-center gap-4 opacity-50"><div className="h-px bg-white/20 flex-1"></div><span className="text-[10px] uppercase font-bold tracking-widest">OR</span><div className="h-px bg-white/20 flex-1"></div></div>
                        <button onClick={handleGoogle} className="w-full bg-white text-black font-bold py-2.5 rounded-xl flex items-center justify-center gap-3 hover:bg-slate-200 transition-colors shadow-lg active:scale-[0.98] uppercase text-[10px] tracking-widest"><svg className="w-4 h-4" viewBox="0 0 24 24"><path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" /><path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" /><path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" /><path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" /></svg> GOOGLE ACCESS</button>
                        <div className="mt-8 text-center"><button onClick={() => setMode(mode === 'signin' ? 'signup' : 'signin')} className="text-brand-400 text-[10px] font-mono border-b border-dashed border-brand-500/50 pb-0.5 hover:text-white transition-colors uppercase tracking-widest">{mode === 'signin' ? 'New User? Initialize Protocol' : 'Existing User? Authenticate'}</button></div>
                    </div>
                </div>
            );
        };

        /* --- LANDING PAGE --- */
        const LandingPage = ({ onLogin }) => {
            const [typedText, setTypedText] = useState("");

            useEffect(() => {
                const textOptions = ["System Initialization...", "Optimizing for TCS NQT...", "DSA Protocol Ready."];
                let textIdx = 0, charIdx = 0, isDeleting = false, timeout;
                const type = () => {
                    const currentText = textOptions[textIdx];
                    if (isDeleting) { setTypedText(currentText.substring(0, charIdx - 1)); charIdx--; }
                    else { setTypedText(currentText.substring(0, charIdx + 1)); charIdx++; }
                    if (!isDeleting && charIdx === currentText.length) timeout = setTimeout(() => { isDeleting = true; type(); }, 2000);
                    else if (isDeleting && charIdx === 0) { isDeleting = false; textIdx = (textIdx + 1) % textOptions.length; timeout = setTimeout(type, 500); }
                    else timeout = setTimeout(type, isDeleting ? 50 : 100);
                };
                timeout = setTimeout(type, 100);
                return () => clearTimeout(timeout);
            }, []);



            return (
                <div className="min-h-screen text-white font-sans selection:bg-brand-500/30 overflow-hidden relative">
                    {/* Background Ambience / Digital Rain Placeholder */}
                    <div className="fixed inset-0 z-0 pointer-events-none">
                        <div className="scifi-grid-animated absolute inset-0"></div>
                        <div className="absolute top-0 inset-x-0 h-32 bg-gradient-to-b from-[#05050a] to-transparent z-10"></div>
                        <div className="absolute bottom-0 inset-x-0 h-32 bg-gradient-to-t from-[#05050a] to-transparent z-10"></div>
                    </div>

                    {/* Navigation */}
                    <nav className="fixed top-0 w-full z-50 transition-all duration-500 bg-transparent py-6">
                        <div className="max-w-7xl mx-auto px-6 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-brand-500 to-brand-600 flex items-center justify-center font-bold text-white shadow-[0_0_15px_rgba(var(--brand-500),0.5)]">V</div>
                                <span className="font-bold text-lg tracking-tight">VELOSIFY</span>
                            </div>
                            <div className="flex items-center gap-6">
                                <button onClick={() => document.getElementById('features').scrollIntoView({ behavior: 'smooth' })} className="hidden md:block text-slate-400 hover:text-white text-sm font-medium transition-colors">Modules</button>
                                <button onClick={onLogin} className="px-4 py-2 bg-white text-black hover:bg-brand-500 hover:text-white font-bold rounded-lg transition-all text-[10px] uppercase tracking-widest transform hover:scale-105 active:scale-95">Access Terminal</button>
                            </div>
                        </div>
                    </nav>

                    {/* SECTION 1: HERO */}
                    <section className="relative min-h-screen flex flex-col justify-center items-center overflow-hidden">
                        <div className="z-10 text-center max-w-5xl px-6 relative">
                            <div className="mb-6 inline-flex items-center gap-2 px-3 py-1 rounded-full border border-brand-500/30 bg-brand-500/10 text-brand-400 text-xs font-mono uppercase tracking-widest animate-pulse">
                                <span className="w-2 h-2 rounded-full bg-brand-500"></span> Neural Link Established
                            </div>
                            <h1 className="text-6xl md:text-8xl font-black tracking-tighter mb-4 leading-none text-transparent bg-clip-text bg-gradient-to-r from-white via-brand-400 to-slate-400 drop-shadow-[0_0_30px_rgba(255,255,255,0.2)]">UPGRADE YOUR BRAIN.</h1>
                            <h1 className="text-6xl md:text-8xl font-black tracking-tighter mb-8 leading-none text-transparent bg-clip-text bg-gradient-to-r from-brand-600 via-brand-400 to-brand-600 drop-shadow-[0_0_30px_rgba(var(--brand-500),0.4)]">HACK YOUR PLACEMENT.</h1>
                            <div className="h-8 mb-12 font-mono text-brand-400 text-lg md:text-xl tracking-[0.2em] uppercase">&gt; {typedText}<span className="animate-blink">_</span></div>
                            <button onClick={onLogin} className="group relative px-8 py-4 bg-brand-600 text-white font-bold text-lg rounded-xl overflow-hidden transition-all hover:scale-105 active:scale-95 shadow-[0_0_40px_rgba(var(--brand-500),0.5)] border border-brand-400/50">
                                <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent translate-x-[-100%] group-hover:animate-[shimmer_0.5s_infinite]"></div>
                                <span className="relative flex items-center gap-3 uppercase tracking-widest text-sm"><Icon name="zap" size={20} className="fill-white" /> Initialize System</span>
                            </button>
                        </div>
                    </section>

                    {/* SECTION 2: VISUAL SHOWCASE */}
                    <section className="py-20 px-6 relative z-20 -mt-20">
                        <div className="max-w-6xl mx-auto">
                            <div className="relative rounded-3xl border border-white/10 bg-surface-900/80 backdrop-blur-xl shadow-[0_0_100px_rgba(var(--brand-500),0.15)] overflow-hidden">
                                <div className="absolute inset-0 bg-gradient-to-br from-white/5 to-transparent opacity-50 pointer-events-none"></div>
                                <div className="h-12 border-b border-white/10 flex items-center px-6 gap-4 bg-black/40">
                                    <div className="flex gap-2"><div className="w-3 h-3 rounded-full bg-red-500/50"></div><div className="w-3 h-3 rounded-full bg-yellow-500/50"></div><div className="w-3 h-3 rounded-full bg-emerald-500/50"></div></div>
                                    <div className="flex-1 text-center font-mono text-[10px] text-slate-500 uppercase tracking-widest flex items-center justify-center gap-2"><Icon name="lock" size={10} /> Velosify v2.0 // Neural Interface Active</div>
                                </div>
                                <div className="relative overflow-hidden">
                                    <div className="absolute inset-0 bg-brand-500/10 mix-blend-overlay z-10 pointer-events-none"></div>
                                    <img
                                        src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?q=80&w=3540&auto=format&fit=crop"
                                        alt="Dashboard Interface"
                                        className="w-full h-auto object-cover opacity-90"
                                    />
                                    <div className="absolute inset-0 bg-gradient-to-t from-surface-900 via-transparent to-transparent z-20"></div>

                                    {/* Floating Graphics Overlay - Advanced Metrics */}
                                    <div className="absolute bottom-8 left-8 right-8 z-30 grid grid-cols-1 md:grid-cols-3 gap-4">
                                        {/* Metric 1: CPU Intelligence */}
                                        <div className="bg-[#05050a]/90 backdrop-blur-xl border border-white/10 p-4 rounded-xl shadow-2xl relative overflow-hidden group">
                                            <div className="absolute inset-0 bg-brand-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                            <div className="flex justify-between items-start mb-2 relative z-10">
                                                <div className="flex items-center gap-2">
                                                    <div className="p-1.5 bg-brand-500/10 rounded-md text-brand-400"><Icon name="cpu" size={14} /></div>
                                                    <span className="text-[10px] font-mono text-slate-400 uppercase tracking-widest font-bold">Neural CPU</span>
                                                </div>
                                                <span className="text-xs font-mono font-bold text-brand-400">84%</span>
                                            </div>
                                            <div className="h-12 w-full relative z-10">
                                                <svg className="w-full h-full" viewBox="0 0 100 40" preserveAspectRatio="none">
                                                    <path d="M0,35 L10,30 L20,38 L30,20 L40,30 L50,10 L60,25 L70,15 L80,30 L90,10 L100,25" fill="none" stroke="currentColor" className="text-brand-500" strokeWidth="1.5" vectorEffect="non-scaling-stroke" />
                                                    <path d="M0,35 L10,30 L20,38 L30,20 L40,30 L50,10 L60,25 L70,15 L80,30 L90,10 L100,25 V40 H0 Z" fill="currentColor" className="text-brand-500/10" />
                                                </svg>
                                            </div>
                                        </div>

                                        {/* Metric 2: Network Flux */}
                                        <div className="bg-[#05050a]/90 backdrop-blur-xl border border-white/10 p-4 rounded-xl shadow-2xl relative overflow-hidden group">
                                            <div className="absolute inset-0 bg-emerald-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                            <div className="flex justify-between items-start mb-2 relative z-10">
                                                <div className="flex items-center gap-2">
                                                    <div className="p-1.5 bg-emerald-500/10 rounded-md text-emerald-400"><Icon name="activity" size={14} /></div>
                                                    <span className="text-[10px] font-mono text-slate-400 uppercase tracking-widest font-bold">Data Flux</span>
                                                </div>
                                                <span className="text-xs font-mono font-bold text-emerald-400">4.2 GB/s</span>
                                            </div>
                                            <div className="h-12 w-full flex items-end gap-1 relative z-10 px-1">
                                                <div className="w-1/12 bg-emerald-500/20 h-[40%] rounded-sm"></div>
                                                <div className="w-1/12 bg-emerald-500/40 h-[70%] rounded-sm"></div>
                                                <div className="w-1/12 bg-emerald-500/30 h-[50%] rounded-sm"></div>
                                                <div className="w-1/12 bg-emerald-500/60 h-[80%] rounded-sm"></div>
                                                <div className="w-1/12 bg-emerald-500/40 h-[60%] rounded-sm"></div>
                                                <div className="w-1/12 bg-emerald-500/80 h-[90%] rounded-sm animate-pulse"></div>
                                                <div className="w-1/12 bg-emerald-500/50 h-[50%] rounded-sm"></div>
                                                <div className="w-1/12 bg-emerald-500/30 h-[40%] rounded-sm"></div>
                                                <div className="w-1/12 bg-emerald-500/60 h-[70%] rounded-sm"></div>
                                                <div className="w-1/12 bg-emerald-500/40 h-[50%] rounded-sm"></div>
                                                <div className="w-1/12 bg-emerald-500/20 h-[30%] rounded-sm"></div>
                                                <div className="w-1/12 bg-emerald-500/10 h-[20%] rounded-sm"></div>
                                            </div>
                                        </div>

                                        {/* Metric 3: System Stability */}
                                        <div className="bg-[#05050a]/90 backdrop-blur-xl border border-white/10 p-4 rounded-xl shadow-2xl relative overflow-hidden group">
                                            <div className="absolute inset-0 bg-pink-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                            <div className="flex justify-between items-start mb-4 relative z-10">
                                                <div className="flex items-center gap-2">
                                                    <div className="p-1.5 bg-pink-500/10 rounded-md text-pink-400"><Icon name="zap" size={14} /></div>
                                                    <span className="text-[10px] font-mono text-slate-400 uppercase tracking-widest font-bold">Core Stability</span>
                                                </div>
                                                <span className="text-xs font-mono font-bold text-pink-400">99.9%</span>
                                            </div>
                                            <div className="h-2 w-full bg-slate-800 rounded-full overflow-hidden relative z-10">
                                                <div className="h-full w-[99.9%] bg-gradient-to-r from-pink-600 to-pink-400 shadow-[0_0_15px_rgba(236,72,153,0.5)]"></div>
                                            </div>
                                            <div className="mt-2 flex justify-between text-[8px] font-mono text-slate-500 uppercase tracking-widest">
                                                <span>Lat: 12ms</span>
                                                <span>Uptime: 42d</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="features" className="py-24 px-6 max-w-7xl mx-auto relative z-10">
                        <h2 className="text-4xl md:text-5xl font-black text-center mb-16 tracking-tighter">
                            SYSTEM <span className="text-brand-400">ARCHETYPE</span>
                        </h2>
                        <div className="grid grid-cols-1 md:grid-cols-4 grid-rows-2 gap-6 h-[800px] md:h-[600px]">
                            {/* Box 1: Deep Work Protocol */}
                            <div className="md:col-span-2 md:row-span-2 relative group overflow-hidden rounded-3xl border border-white/10 bg-surface-900/60 backdrop-blur-md p-8 hover:border-brand-500/50 transition-all">
                                {/* Logo Graphic */}
                                <div className="absolute -bottom-10 -right-10 text-brand-500/5 group-hover:text-brand-500/10 transition-colors pointer-events-none">
                                    <Icon name="brain-circuit" size={240} strokeWidth={0.5} />
                                </div>
                                <div className="relative z-10 h-full flex flex-col">
                                    <div className="w-14 h-14 rounded-2xl bg-brand-500/20 flex items-center justify-center text-brand-400 mb-6 group-hover:scale-110 transition-transform backdrop-blur-sm border border-brand-500/20"><Icon name="monitor" size={28} /></div>
                                    <h3 className="text-2xl font-bold mb-3 z-10">Deep Work Protocol</h3>
                                    <p className="text-slate-400 text-sm leading-relaxed mb-8 z-10">Engage the Focus Engine. High-intensity 90-minute sprints. Block distractions and enter pure flow state.</p>
                                    <div className="mt-auto rounded-xl bg-black/40 border border-white/5 h-48 relative overflow-hidden flex items-center justify-center backdrop-blur-md">
                                        <div className="text-4xl font-mono text-white font-black tracking-tighter z-10">25:00</div>
                                        <div className="absolute inset-0 border-2 border-brand-500/20 rounded-xl"></div>
                                        <div className="absolute inset-0 bg-brand-500/5 animate-pulse"></div>
                                    </div>
                                </div>
                            </div>

                            {/* Box 2: DSA Tracker */}
                            <div className="md:col-span-2 relative group overflow-hidden rounded-3xl border border-white/10 bg-surface-900/60 backdrop-blur-md p-8 hover:border-emerald-500/50 transition-all">
                                {/* Logo Graphic */}
                                <div className="absolute -bottom-6 -right-6 text-emerald-500/5 group-hover:text-emerald-500/10 transition-colors pointer-events-none">
                                    <Icon name="binary" size={180} strokeWidth={0.5} />
                                </div>
                                <div className="relative z-10 flex flex-col h-full justify-between">
                                    <div>
                                        <div className="flex justify-between items-start mb-4">
                                            <div className="w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center text-emerald-400 backdrop-blur-sm border border-emerald-500/20"><Icon name="database" size={24} /></div>
                                            <span className="bg-emerald-500/10 text-emerald-400 px-3 py-1 rounded-full text-[10px] font-bold uppercase border border-emerald-500/20">Striver Sheet</span>
                                        </div>
                                        <h3 className="text-xl font-bold mb-2">DSA Tracker</h3>
                                        <p className="text-slate-400 text-xs">Curated algorithm sheets. Track progress through graphs and heaps.</p>
                                    </div>
                                    <div className="w-full h-2 bg-white/10 rounded-full mt-4 overflow-hidden"><div className="h-full bg-emerald-500 w-[65%] shadow-[0_0_10px_currentColor]"></div></div>
                                </div>
                            </div>

                            {/* Box 3: Neural Flashcards */}
                            <div className="relative group overflow-hidden rounded-3xl border border-white/10 bg-surface-900/60 backdrop-blur-md p-6 hover:border-pink-500/50 transition-all">
                                {/* Logo Graphic */}
                                <div className="absolute -bottom-4 -right-4 text-pink-500/5 group-hover:text-pink-500/10 transition-colors pointer-events-none">
                                    <Icon name="layers" size={120} strokeWidth={0.5} />
                                </div>
                                <div className="relative z-10">
                                    <div className="w-10 h-10 rounded-lg bg-pink-500/20 flex items-center justify-center text-pink-400 mb-4 backdrop-blur-sm border border-pink-500/20"><Icon name="zap" size={20} /></div>
                                    <h3 className="text-lg font-bold mb-2">Neural Flashcards</h3>
                                    <p className="text-slate-400 text-xs">Spaced repetition for long-term retention.</p>
                                </div>
                            </div>

                            {/* Box 4: Analytics - Visualized */}
                            <div className="relative group overflow-hidden rounded-3xl border border-white/10 bg-[#0B0C15] p-0 hover:border-blue-500/50 transition-all flex flex-col">
                                {/* Header / Stats */}
                                <div className="p-5 border-b border-white/5 bg-surface-900/40 backdrop-blur-md relative z-10">
                                    <div className="flex items-center justify-between mb-4">
                                        <div className="flex items-center gap-3">
                                            <div className="w-8 h-8 rounded-lg bg-blue-500/20 flex items-center justify-center text-blue-400 border border-blue-500/20"><Icon name="activity" size={16} /></div>
                                            <h3 className="text-sm font-bold text-slate-200">Session Analytics</h3>
                                        </div>
                                        <Icon name="more-horizontal" className="text-slate-600" size={16} />
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div><div className="text-[10px] text-slate-500 uppercase tracking-wider font-bold">Bounce Rate</div><div className="text-lg font-mono font-bold text-white">40.6%</div></div>
                                        <div><div className="text-[10px] text-slate-500 uppercase tracking-wider font-bold">Page Views</div><div className="text-lg font-mono font-bold text-emerald-400">2.7M</div></div>
                                    </div>
                                </div>

                                {/* Chart Area */}
                                <div className="relative flex-1 p-5 pt-8 flex items-end gap-1.5 overflow-hidden">
                                    {/* Grid Background */}
                                    <div className="absolute inset-0 opacity-20" style={{ backgroundImage: 'linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px)', backgroundSize: '20px 20px' }}></div>

                                    {/* Bars */}
                                    <div className="w-full bg-sky-500/20 h-[30%] rounded-sm group-hover:bg-sky-500/40 transition-all duration-500 delay-0"></div>
                                    <div className="w-full bg-sky-500/30 h-[50%] rounded-sm group-hover:bg-sky-500/50 transition-all duration-500 delay-75"></div>
                                    <div className="w-full bg-sky-500/40 h-[40%] rounded-sm group-hover:bg-sky-500/60 transition-all duration-500 delay-100"></div>
                                    <div className="w-full bg-sky-500/30 h-[70%] rounded-sm group-hover:bg-sky-500/50 transition-all duration-500 delay-150 relative group/bar">
                                        {/* Tooltip */}
                                        <div className="absolute -top-10 left-1/2 -translate-x-1/2 bg-white text-black text-[9px] font-bold py-1 px-2 rounded opacity-0 group-hover/bar:opacity-100 transition-opacity whitespace-nowrap z-20 shadow-xl pointer-events-none transform translate-y-2 group-hover/bar:translate-y-0 duration-300">
                                            57.1% <div className="absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-white rotate-45"></div>
                                        </div>
                                        <div className="absolute inset-0 bg-sky-400 opacity-0 group-hover/bar:opacity-100 transition-opacity"></div>
                                    </div>
                                    <div className="w-full bg-sky-500/50 h-[45%] rounded-sm group-hover:bg-sky-500/70 transition-all duration-500 delay-200"></div>
                                    <div className="w-full bg-sky-500/30 h-[35%] rounded-sm group-hover:bg-sky-500/50 transition-all duration-500 delay-300"></div>
                                    <div className="w-full bg-sky-500/40 h-[60%] rounded-sm group-hover:bg-sky-500/60 transition-all duration-500 delay-400"></div>
                                    <div className="w-full bg-sky-500/20 h-[80%] rounded-sm group-hover:bg-sky-500/40 transition-all duration-500 delay-500"></div>
                                    <div className="w-full bg-sky-500/40 h-[55%] rounded-sm group-hover:bg-sky-500/60 transition-all duration-500 delay-600"></div>
                                    <div className="w-full bg-sky-500/30 h-[40%] rounded-sm group-hover:bg-sky-500/50 transition-all duration-500 delay-700"></div>

                                    {/* Line Graph SVG Overlay */}
                                    <svg className="absolute inset-0 w-full h-full pointer-events-none z-10" preserveAspectRatio="none">
                                        <path d="M0,100 C20,90 40,60 60,80 S100,40 120,50 S160,20 180,40 S220,10 300,30"
                                            fill="none"
                                            stroke="#F472B6"
                                            strokeWidth="3"
                                            strokeLinecap="round"
                                            className="drop-shadow-[0_0_6px_rgba(244,114,182,0.6)]"
                                            vectorEffect="non-scaling-stroke" />
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </section>

                    {/* SECTION 4: FOOTER */}
                    <footer className="border-t border-white/5 bg-[#030305] relative z-10">
                        <div className="overflow-hidden py-3 bg-brand-900/10 border-b border-white/5">
                            <div className="whitespace-nowrap animate-[marquee_20s_linear_infinite] text-[10px] font-mono text-brand-400 font-bold uppercase tracking-[0.3em] flex gap-12">
                                <span>SYSTEM STATUS: ONLINE</span><span>USERS: ACTIVE</span><span>VERSION: 2.0.4</span><span>LATENCY: 12ms</span><span>ENCRYPTION: AES-256</span>
                                <span>SYSTEM STATUS: ONLINE</span><span>USERS: ACTIVE</span><span>VERSION: 2.0.4</span><span>LATENCY: 12ms</span><span>ENCRYPTION: AES-256</span>
                            </div>
                        </div>
                        <div className="max-w-7xl mx-auto px-6 py-12 flex flex-col md:flex-row justify-between items-center gap-8">
                            <div className="flex items-center gap-3"><div className="w-8 h-8 rounded-lg bg-gradient-to-br from-brand-600 to-brand-500 flex items-center justify-center text-white font-bold">V</div><div><div className="font-bold text-white tracking-tight">VELOSIFY</div><div className="text-[10px] text-slate-500">Neural Study OS</div></div></div>
                            <div className="flex gap-6 grayscale opacity-50 hover:grayscale-0 hover:opacity-100 transition-all duration-500">
                                <div className="flex items-center gap-2 text-xs font-bold text-slate-400"><Icon name="globe" size={14} /> React</div>
                                <div className="flex items-center gap-2 text-xs font-bold text-slate-400"><Icon name="database" size={14} /> Firebase</div>
                                <div className="flex items-center gap-2 text-xs font-bold text-slate-400"><Icon name="layers" size={14} /> Tailwind</div>
                            </div>
                            <div className="text-xs text-slate-600 font-mono">Built by <span className="text-white">Arpit Namdeo</span></div>
                        </div>
                    </footer>
                </div>
            );
        };

        /* --- DASHBOARD COMPONENTS --- */
        const ProgressBar = ({ value, max, color = "bg-brand-500" }) => {
            const p = Math.min(100, Math.max(0, (value / max) * 100));
            return (<div className="w-full bg-black/40 rounded-full h-1.5 overflow-hidden border border-white/5"><div className={cn("h-full rounded-full transition-all duration-1000 shadow-[0_0_10px_currentColor]", color)} style={{ width: `${p}%` }}></div></div>);
        };

        // NEW: RADAR / SPIDER CHART FOR PERFORMANCE METRICS
        const RadarChart = ({ data }) => {
            // data: [{ label, value (0-100) }]
            const size = 300;
            const center = size / 2;
            const radius = 100;
            const angleSlice = (Math.PI * 2) / data.length;

            // Helper to get coordinates
            const getCoords = (val, i) => {
                const angle = i * angleSlice - Math.PI / 2;
                const r = (val / 100) * radius;
                return { x: center + r * Math.cos(angle), y: center + r * Math.sin(angle) };
            };

            // Generate Path for Data Area
            const pathData = data.map((d, i) => {
                const { x, y } = getCoords(d.value, i);
                return `${x},${y}`;
            }).join(' ');

            return (
                <div className="flex items-center justify-center p-4 h-full relative">
                    <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`} className="overflow-visible">
                        {/* Background Grid (Concentric Polygons) */}
                        {[20, 40, 60, 80, 100].map((level, idx) => (
                            <polygon
                                key={idx}
                                points={data.map((_, i) => {
                                    const { x, y } = getCoords(level, i);
                                    return `${x},${y}`;
                                }).join(' ')}
                                fill="none"
                                stroke="#334155"
                                strokeWidth="0.5"
                                strokeDasharray="4 4"
                                className="opacity-30"
                            />
                        ))}

                        {/* Axes Lines */}
                        {data.map((_, i) => {
                            const { x, y } = getCoords(100, i);
                            return <line key={i} x1={center} y1={center} x2={x} y2={y} stroke="#334155" strokeWidth="0.5" className="opacity-30" />;
                        })}

                        {/* The Data Polygon */}
                        <polygon
                            points={pathData}
                            fill="rgba(14, 165, 233, 0.2)"
                            stroke="#0ea5e9"
                            strokeWidth="2"
                            className="drop-shadow-[0_0_10px_rgba(14,165,233,0.5)] animate-pulse"
                        />

                        {/* Data Points */}
                        {data.map((d, i) => {
                            const { x, y } = getCoords(d.value, i);
                            return (
                                <g key={i}>
                                    <circle cx={x} cy={y} r="3" className="fill-brand-400" />
                                    {/* Labels located outside the polygon */}
                                    <text
                                        x={center + (radius + 25) * Math.cos(i * angleSlice - Math.PI / 2)}
                                        y={center + (radius + 25) * Math.sin(i * angleSlice - Math.PI / 2)}
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        className="text-[10px] fill-slate-400 font-mono uppercase font-bold tracking-wider"
                                    >
                                        {d.label}
                                    </text>
                                </g>
                            );
                        })}
                    </svg>
                </div>
            );
        };

        const StatCard = ({ label, value, sub, icon, color }) => (
            <Card className={cn("border-t-2", color)}>
                <div className="flex justify-between items-start mb-4">
                    <div className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">{label}</div>
                    <div className="p-2 rounded-lg bg-white/5 text-slate-300"><Icon name={icon} size={16} /></div>
                </div>
                <div className="text-3xl font-bold text-white tracking-tight">{value}</div>
                {sub && <div className="text-xs text-slate-500 mt-1 font-mono">{sub}</div>}
            </Card>
        );

        /* --- FEATURE MODULES --- */
        const Dashboard = ({ user, setTab }) => {
            const stats = useMemo(() => {
                // Approximate Total Modules derived from templates
                // g1-g9 (GATE) have roughly ~35-40 topics total.
                // Using a rough estimate for visualization if user.syllabusTracker is sparse.

                const tracker = user.syllabusTracker || {};
                let comp = 0;

                Object.values(tracker).forEach(subject => {
                    Object.values(subject).forEach(status => {
                        if (status === 'done') comp++;
                    });
                });

                // Prepare Data for Radar Chart derived from known Subject IDs
                const getSubjectProgress = (ids) => {
                    let total = 0;
                    let done = 0;
                    const subjectList = Array.isArray(ids) ? ids : [ids];

                    subjectList.forEach(sid => {
                        const sData = tracker[sid] || {};
                        // Mocking total subtopics per subject as average 5 for calculation
                        // Since we don't have the full template here, we estimate "mastery" based on done count vs expected ~5
                        const sKeys = Object.keys(sData);
                        done += Object.values(sData).filter(v => v === 'done').length;
                        // Determine progress: If tracked items exist, use them, else 0. 
                        // To make the graph look active, we normalize 'done' against a standard denominator.
                        total += 5;
                    });

                    return Math.min(100, Math.round((done / total) * 100));
                };

                const graphData = [
                    { label: 'Calculus', value: getSubjectProgress(['g1']) }, // Math
                    { label: 'Logic', value: getSubjectProgress(['g2', 'g5']) }, // Logic + TOC
                    { label: 'Systems', value: getSubjectProgress(['g3', 'g7']) }, // CO + OS
                    { label: 'Software', value: getSubjectProgress(['g6', 'g8']) }, // Compiler + DBMS
                    { label: 'Network', value: getSubjectProgress(['g9']) }, // CN
                    { label: 'Code', value: getSubjectProgress(['g4']) }, // DSA
                ];

                return { comp, tot: 45, doing: user.kanban?.doing?.length || 0, done: user.kanban?.done?.length || 0, graphData };
            }, [user]);

            const nextExam = new Date(user.examDate || '2026-02-01');
            const daysLeft = Math.ceil((nextExam - new Date()) / (1000 * 60 * 60 * 24));

            return (
                <div className="space-y-8 animate-fade-in">
                    <div className="flex flex-col md:flex-row md:items-end justify-between gap-6 pb-6 border-b border-white/5">
                        <div>
                            <div className="flex items-center gap-3 mb-2"><span className="px-2 py-0.5 rounded bg-brand-500/20 text-brand-400 text-[10px] font-bold uppercase tracking-widest border border-brand-500/30">Lvl 1  Initiate</span></div>
                            <h2 className="text-4xl font-bold text-white tracking-tight">Command Center</h2>
                        </div>
                        <div className="text-right hidden md:block">
                            <div className="text-5xl font-mono font-bold text-white tracking-tighter">{daysLeft}</div>
                            <div className="text-xs text-brand-400 uppercase tracking-[0.3em] font-bold mt-1 opacity-70">Days to Launch</div>
                        </div>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <StatCard label="Syllabus" value={`${Math.round((stats.comp / stats.tot) * 100) || 0}%`} sub={`${stats.comp}/${stats.tot} Modules`} icon="book-open" color="border-emerald-500" />
                        <StatCard label="Projects" value={stats.doing} sub={`${stats.done} Completed`} icon="trello" color="border-brand-500" />
                        <StatCard label="Focus Time" value={`${Math.floor((user.totalTime || 0) / 60)}h`} sub="Total Elapsed" icon="clock" color="border-purple-500" />
                        <StatCard label="Review" value={(user.flashcards || []).length} sub="Cards in Deck" icon="zap" color="border-pink-500" />
                    </div>
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <Card className="lg:col-span-2 min-h-[400px] flex flex-col">
                            <div className="flex justify-between items-center mb-6 border-b border-white/5 pb-4">
                                <h3 className="font-bold text-white flex gap-2 items-center"><Icon name="hexagon" className="text-brand-400" /> NEURAL SKILL MAP</h3>
                                <span className="text-[10px] font-mono text-slate-500 uppercase">Real-time Analysis</span>
                            </div>
                            <div className="flex-1 w-full bg-[#05050a] rounded-2xl border border-white/5 shadow-inner">
                                <RadarChart data={stats.graphData} />
                            </div>
                        </Card>
                        <Card className="flex flex-col items-center justify-center text-center !bg-brand-900/10 border-brand-500/20 relative group cursor-pointer lg:h-full" onClick={() => setTab('focus')}>
                            <div className="absolute inset-0 bg-brand-500/5 group-hover:bg-brand-500/10 transition-colors"></div>
                            <div className="w-20 h-20 rounded-full bg-black border border-brand-500/50 flex items-center justify-center mb-6 shadow-[0_0_40px_rgba(var(--brand-500),0.3)] group-hover:scale-110 transition-transform"><Icon name="play" size={32} className="text-white ml-1" /></div>
                            <h3 className="text-xl font-bold text-white z-10">Engage Focus</h3>
                            <p className="text-brand-300 text-xs mt-2 z-10 opacity-70 px-6">Enter deep learning state. Tracking enabled.</p>
                        </Card>
                    </div>
                </div>
            );
        };

        const FocusMode = ({ focus, setFocus }) => {
            const { motion, AnimatePresence } = window.Motion;
            const [strict, setStrict] = useState(false);
            const [dCount, setDCount] = useState(0);
            const [streak, setStreak] = useState(0); // Session streak
            const [intent, setIntent] = useState("");
            const [isIntentLocked, setIsIntentLocked] = useState(false);
            const [audioMode, setAudioMode] = useState("mute"); // mute, rain, white_noise
            const [volume, setVolume] = useState(0.5);
            const [zenMode, setZenMode] = useState(false);
            const [showMissionComplete, setShowMissionComplete] = useState(false);

            const audioRef = useRef(null);

            // Audio Sources
            const AUDIO_SRCS = {
                rain: "https://cdn.pixabay.com/audio/2022/03/24/audio_3398939626.mp3",
                white_noise: "https://cdn.pixabay.com/audio/2022/03/10/audio_c8c8a73467.mp3"
            };

            // Audio Logic
            useEffect(() => {
                if (!audioRef.current) audioRef.current = new Audio();
                const audio = audioRef.current;

                if (audioMode === 'mute' || !focus.isActive) {
                    // Fade out logic could go here, but prompt ask for simple fade out when paused/finished
                    audio.pause();
                } else {
                    audio.src = AUDIO_SRCS[audioMode];
                    audio.loop = true;
                    audio.volume = volume;
                    audio.play().catch(e => console.log("Audio autoplay blocked", e));
                }

                return () => audio.pause();
            }, [audioMode, focus.isActive]);

            // Volume Update
            useEffect(() => {
                if (audioRef.current) audioRef.current.volume = volume;
            }, [volume]);

            const playSfx = (type) => {
                const sfx = new Audio(type === 'complete' ? "https://cdn.pixabay.com/audio/2021/08/04/audio_12b0c7443c.mp3" : type === 'alert' ? "https://cdn.pixabay.com/audio/2021/08/09/audio_2e831c20bd.mp3" : "https://cdn.pixabay.com/audio/2022/03/10/audio_c8c8a73467.mp3");
                sfx.volume = 0.4;
                sfx.play().catch(() => { });
            };

            // Completion Logic
            useEffect(() => {
                if (focus.isActive && focus.timeLeft === 0) {
                    setFocus(p => ({ ...p, isActive: false }));
                    setStreak(s => s + 1);
                    setShowMissionComplete(true);
                    playSfx('complete');
                    setIsIntentLocked(false);
                }
            }, [focus.timeLeft, focus.isActive]);

            const playAlert = () => {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                if (ctx.state === 'suspended') ctx.resume();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(220, ctx.currentTime);
                osc.frequency.linearRampToValueAtTime(110, ctx.currentTime + 0.3);
                gain.gain.setValueAtTime(0.2, ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                osc.start();
                osc.stop(0.3);
            };

            // Proctor Vision Logic
            useEffect(() => {
                const h = () => {
                    if (document.hidden && focus.isActive && strict) {
                        setFocus(p => ({ ...p, isActive: false }));
                        setDCount(c => c + 1);
                        setStreak(0); // Penalty
                        playAlert();
                        playSfx('alert');
                    }
                };
                document.addEventListener("visibilitychange", h);
                return () => document.removeEventListener("visibilitychange", h);
            }, [focus.isActive, strict]);

            const fmt = s => `${Math.floor(s / 60)}:${String(s % 60).padStart(2, '0')}`;

            const toggle = () => {
                playSfx('click');
                if (!intent.trim()) {
                    alert("PROTOCOL ERROR: Define mission objective before engagement.");
                    return;
                }
                setIsIntentLocked(true);
                setFocus({ ...focus, isActive: !focus.isActive });
            };

            const reset = () => {
                playSfx('click');
                setFocus({ ...focus, isActive: false, timeLeft: focus.initialTime });
                setDCount(0);
                setIsIntentLocked(false);
                setIntent("");
            };

            const setTime = (m) => {
                playSfx('click');
                setFocus({ timeLeft: m * 60, initialTime: m * 60, isActive: false });
                setDCount(0);
                setIsIntentLocked(false);
            };

            // Circular Progress Math
            const radius = 120;
            const circumference = 2 * Math.PI * radius;
            const progress = focus.initialTime > 0 ? (focus.timeLeft / focus.initialTime) : 0;
            const dashOffset = circumference * (1 - progress);

            // Color Logic
            const progressColor = progress > 0.5 ? '#22d3ee' : progress > 0.1 ? '#a855f7' : '#ef4444';

            return (
                <div className="max-w-4xl mx-auto py-8 animate-fade-in text-center relative flex flex-col items-center">
                    {/* MISSION COMPLETE MODAL */}
                    <AnimatePresence>
                        {showMissionComplete && (
                            <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className="absolute inset-0 z-50 bg-black/90 backdrop-blur-xl flex flex-col items-center justify-center rounded-3xl border border-emerald-500/30">
                                <motion.div initial={{ scale: 0.8 }} animate={{ scale: 1 }} className="text-center p-8">
                                    <div className="text-emerald-400 mb-4 animate-bounce"><Icon name="award" size={60} /></div>
                                    <h2 className="text-4xl font-bold text-white mb-2">MISSION ACCOMPLISHED</h2>
                                    <p className="text-slate-400 font-mono text-sm mb-6 uppercase tracking-widest">{intent}</p>
                                    <div className="flex justify-center gap-8 mb-8">
                                        <div><div className="text-2xl font-bold text-white">+{Math.floor(focus.initialTime / 60 * 10)}</div><div className="text-[10px] text-brand-400 uppercase tracking-wider">XP Earned</div></div>
                                        <div><div className="text-2xl font-bold text-white">{streak}</div><div className="text-[10px] text-brand-400 uppercase tracking-wider">Streak</div></div>
                                    </div>
                                    <button onClick={() => setShowMissionComplete(false)} className="px-8 py-3 bg-emerald-600 hover:bg-emerald-500 text-white font-bold rounded-xl uppercase tracking-widest transition-all">Continue Operations</button>
                                </motion.div>
                            </motion.div>
                        )}
                    </AnimatePresence>

                    {/* Header HUD (Hidden in Zen Mode) */}
                    {!zenMode && (
                        <div className="w-full flex justify-between items-start mb-8 border-b border-white/5 pb-4 transition-all">
                            <div className="text-left">
                                <h2 className="text-3xl font-bold text-white tracking-tight flex items-center gap-2"><Icon name="cpu" /> FOCUS ENGINE</h2>
                                <p className="text-slate-400 font-mono text-xs">NEURAL SYNCHRONIZATION: {dCount === 0 ? 'OPTIMAL' : 'COMPROMISED'}</p>
                            </div>
                            <div className="text-right flex items-center gap-4">
                                <button onClick={() => setZenMode(true)} className="text-xs font-bold uppercase tracking-widest text-slate-500 hover:text-white flex items-center gap-2 border border-slate-700 px-3 py-1 rounded-full"><Icon name="maximize" size={12} /> Zen Mode</button>
                                <div>
                                    <div className="text-xs text-slate-500 font-bold uppercase tracking-widest">Streak</div>
                                    <div className="text-2xl font-mono text-brand-400">{streak} Sessions</div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Zen Mode Exit Button */}
                    {zenMode && (
                        <button onClick={() => setZenMode(false)} className="absolute top-0 right-0 p-4 text-slate-500 hover:text-white z-50"><Icon name="minimize" /></button>
                    )}

                    {/* Proctor Vision Critical Alert */}
                    <AnimatePresence>
                        {dCount > 0 && strict && (
                            <motion.div
                                initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0 }}
                                className="absolute inset-x-0 top-20 py-3 bg-red-500/10 border border-red-500/50 text-red-500 font-bold uppercase tracking-[0.2em] flex items-center justify-center gap-3 z-50 rounded-xl backdrop-blur-md"
                            >
                                <Icon name="alert-triangle" /> FOCUS BREACH DETECTED (x{dCount})
                            </motion.div>
                        )}
                    </AnimatePresence>

                    {/* Intent Lock Input (Hidden in Zen Mode) */}
                    <div className={`w-full max-w-md mb-12 transition-all duration-500 ${isIntentLocked ? (zenMode ? 'opacity-0 scale-90 pointer-events-none h-0 margin-0' : 'opacity-80 pointer-events-none') : 'opacity-100'} ${zenMode && !isIntentLocked ? 'opacity-0 h-0 pointer-events-none' : ''}`}>
                        {!zenMode && <label className="text-[10px] text-brand-400 font-bold uppercase tracking-widest mb-2 block">Mission Objective</label>}
                        <div className="relative">
                            <input
                                value={intent}
                                onChange={e => setIntent(e.target.value)}
                                placeholder="Enter objective to unlock engines..."
                                disabled={isIntentLocked}
                                className={`w-full bg-black/50 border-2 p-4 rounded-xl text-center font-bold text-white outline-none transition-all ${isIntentLocked ? 'border-brand-500 shadow-[0_0_20px_rgba(var(--brand-500),0.2)]' : 'border-white/10 focus:border-white/30'}`}
                            />
                            {isIntentLocked && <div className="absolute right-4 top-1/2 -translate-y-1/2 text-brand-400"><Icon name="lock" size={16} /></div>}
                        </div>
                    </div>

                    {/* Main ARC REACTOR (Timer) */}
                    <div className={`relative mb-12 group transition-all duration-700 ${zenMode ? 'scale-125 mt-20' : 'scale-100'}`}>
                        {/* SVG Ring */}
                        <div className="relative w-80 h-80 flex items-center justify-center">
                            <svg className="w-full h-full transform -rotate-90 drop-shadow-[0_0_15px_rgba(0,0,0,0.5)]" viewBox="0 0 260 260">
                                {/* Track */}
                                <circle cx="130" cy="130" r={radius} fill="none" stroke="#1e293b" strokeWidth={zenMode ? 4 : 8} />
                                {/* Progress */}
                                <motion.circle
                                    cx="130" cy="130" r={radius} fill="none" stroke={progressColor} strokeWidth={zenMode ? 4 : 8} strokeLinecap="round"
                                    strokeDasharray={circumference}
                                    animate={{ strokeDashoffset: dashOffset }}
                                    transition={{ duration: 1, ease: "linear" }}
                                    className="drop-shadow-[0_0_10px_currentColor]"
                                />
                            </svg>

                            {/* Inner Content */}
                            <div className="absolute inset-0 flex flex-col items-center justify-center z-10">
                                <div className={`text-7xl font-black font-mono tracking-tighter transition-colors ${focus.isActive ? 'text-white' : 'text-slate-500'}`}>
                                    {fmt(focus.timeLeft)}
                                </div>
                                <div className={`mt-2 text-xs font-bold uppercase tracking-[0.3em] ${focus.isActive ? 'text-brand-400 animate-pulse' : 'text-slate-600'}`}>
                                    {focus.isActive ? (zenMode ? 'ENGAGED' : 'SYSTEM ENGAGED') : 'STANDBY'}
                                </div>
                            </div>

                            {/* Ambient Glow */}
                            {focus.isActive && <div className="absolute inset-0 bg-brand-500/5 blur-3xl rounded-full z-0 animate-pulse"></div>}
                        </div>
                    </div>

                    {/* Controls (Hidden in Zen Mode) */}
                    <div className={`flex flex-col gap-6 w-full max-w-lg transition-all duration-500 ${zenMode ? 'opacity-0 translate-y-20 pointer-events-none' : 'opacity-100 translate-y-0'}`}>
                        {/* Audio & Strict Controls */}
                        <div className="flex justify-between items-center bg-white/5 p-4 rounded-2xl border border-white/5">
                            {/* Strict Toggle */}
                            <button onClick={() => { playSfx('click'); !focus.isActive && setStrict(!strict); }} disabled={focus.isActive} className={`px-4 py-2 rounded-lg border text-[10px] font-bold uppercase tracking-widest transition-all flex items-center gap-2 ${strict ? 'bg-red-500/20 border-red-500 text-red-400' : 'bg-transparent border-slate-700 text-slate-500 hover:text-white'} ${focus.isActive && 'opacity-50 cursor-not-allowed'}`}>
                                {strict ? <><Icon name="shield" size={12} /> Proctor: ON</> : <><Icon name="shield-off" size={12} /> Proctor: OFF</>}
                            </button>

                            {/* Audio Controls */}
                            <div className="flex items-center gap-3">
                                <div className="flex items-center gap-2 bg-black/40 rounded-lg p-1">
                                    <button onClick={() => setAudioMode('mute')} className={`p-2 rounded ${audioMode === 'mute' ? 'bg-white/10 text-white' : 'text-slate-500 hover:text-white'}`}><Icon name="volume-x" size={14} /></button>
                                    <button onClick={() => setAudioMode('rain')} className={`p-2 rounded ${audioMode === 'rain' ? 'bg-cyan-500/20 text-cyan-400' : 'text-slate-500 hover:text-white'}`}><Icon name="cloud-rain" size={14} /></button>
                                    <button onClick={() => setAudioMode('white_noise')} className={`p-2 rounded ${audioMode === 'white_noise' ? 'bg-white/20 text-white' : 'text-slate-500 hover:text-white'}`}><Icon name="waves" size={14} /></button>
                                </div>
                                {audioMode !== 'mute' && (
                                    <input type="range" min="0" max="1" step="0.1" value={volume} onChange={e => setVolume(parseFloat(e.target.value))} className="w-16 h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer" />
                                )}
                            </div>
                        </div>

                        {/* Main Buttons */}
                        <div className="flex gap-4">
                            <button onClick={toggle} className={`flex-1 py-4 rounded-xl font-bold text-black text-sm uppercase tracking-widest shadow-lg hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-3 ${focus.isActive ? 'bg-amber-400 hover:bg-amber-300' : 'bg-brand-500 hover:bg-brand-400'}`}>
                                <Icon name={focus.isActive ? "pause" : "power"} size={18} /> {focus.isActive ? "HALT SYSTEM" : "INITIALIZE"}
                            </button>
                            <button onClick={reset} className="px-6 rounded-xl bg-surface-800 text-slate-400 hover:text-white hover:bg-surface-700 border border-white/5 transition-colors">
                                <Icon name="rotate-ccw" size={18} />
                            </button>
                        </div>

                        {/* Presets */}
                        <div className="flex justify-center gap-3 opacity-60 hover:opacity-100 transition-opacity">
                            {[25, 45, 60, 90].map(m => (
                                <button key={m} onClick={() => setTime(m)} className="px-4 py-2 rounded border border-white/10 hover:bg-white/10 text-[10px] font-mono font-bold text-slate-500 hover:text-white transition-colors">{m}m</button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        /* --- SYLLABUS & TRACKER COMPONENT (UPDATED V2) --- */
        const Syllabus = ({ user, update, log }) => {
            const { motion, AnimatePresence } = window.Motion;
            const [mode, setMode] = useState('GATE'); // GATE, PLACEMENT, INTERVIEW
            const [expandedSubjectId, setExpandedSubjectId] = useState(null);
            const [customTopic, setCustomTopic] = useState({ subject: '', topic: '' });

            // INITIAL TEMPLATE DATA GENERATOR
            const getTemplateData = () => ({
                GATE: [
                    { id: 'g1', name: 'Engineering Mathematics', topics: ['Linear Algebra', 'Calculus', 'Probability', 'Discrete Mathematics'] },
                    { id: 'g2', name: 'Digital Logic', topics: ['Boolean Algebra', 'Combinational Circuits', 'Sequential Circuits', 'Number Systems'] },
                    { id: 'g3', name: 'Computer Organization', topics: ['Machine Instructions', 'Pipelining', 'Memory Hierarchy', 'I/O Organization'] },
                    { id: 'g4', name: 'Data Structures & Algorithms', topics: ['Arrays', 'Linked Lists', 'Stacks & Queues', 'Trees & Graphs', 'Sorting & Searching'] },
                    { id: 'g5', name: 'Theory of Computation', topics: ['Regular Expressions', 'Context-Free Grammars', 'Turing Machines', 'Undecidability'] },
                    { id: 'g6', name: 'Compiler Design', topics: ['Lexical Analysis', 'Parsing', 'Syntax Directed Translation', 'Code Optimization'] },
                    { id: 'g7', name: 'Operating Systems', topics: ['Processes & Threads', 'CPU Scheduling', 'Deadlocks', 'Memory Management'] },
                    { id: 'g8', name: 'Database Management', topics: ['ER-Model', 'SQL', 'Normalization', 'Transactions', 'Indexing'] },
                    { id: 'g9', name: 'Computer Networks', topics: ['OSI Model', 'TCP/IP', 'Subnetting', 'Routing Algorithms', 'Application Layer'] }
                ],
                PLACEMENT: [
                    { id: 'p1', name: 'Data Structures (Coding)', topics: ['Arrays & Strings', 'Linked List Manipulation', 'Tree Traversals', 'Graph BFS/DFS'] },
                    { id: 'p2', name: 'Algorithms', topics: ['Dynamic Programming (DP)', 'Greedy Algorithms', 'Backtracking', 'Bit Manipulation'] },
                    { id: 'p3', name: 'Aptitude & Logic', topics: ['Time & Work', 'Profit & Loss', 'Permutations & Combinations', 'Data Interpretation'] },
                    { id: 'p4', name: 'CS Fundamentals', topics: ['OS Concepts', 'DBMS SQL Queries', 'CN Basics', 'OOPs Concepts'] }
                ],
                INTERVIEW: [
                    { id: 'i1', name: 'HR Round Prep', topics: ['Tell me about yourself', 'Strengths & Weaknesses', 'Where do you see yourself in 5 years?', 'Why should we hire you?'] },
                    { id: 'i2', name: 'Behavioral Questions', topics: ['Handling Conflict', 'Leadership Experience', 'Failure & Learning', 'Teamwork Situations'] },
                    { id: 'i3', name: 'Project Discussions', topics: ['Project Architecture', 'Challenges Faced', 'Tech Stack Justification', 'Future Improvements'] }
                ]
            });

            // Initialize or Hydrate State from User Data
            // We use 'syllabusTracker' in user object to store the status of all topics.
            // Structure: { [subjectId]: { [topicName]: 'not-started' | 'in-progress' | 'done' } }

            const [syllabusState, setSyllabusState] = useState(user.syllabusTracker || {});

            // Update user persistence whenever local state changes
            useEffect(() => {
                if (JSON.stringify(user.syllabusTracker) !== JSON.stringify(syllabusState)) {
                    update({ ...user, syllabusTracker: syllabusState });
                }
            }, [syllabusState]);

            // Construct the Display Data dynamically
            const displayData = useMemo(() => {
                const templates = getTemplateData()[mode] || [];
                const custom = (user.customSyllabus || []).filter(item => item.mode === mode);

                // Combine and hydrate with status
                return [...templates, ...custom].map(subject => {
                    // Normalize topics to object structure if they are strings (template) or objects (custom)
                    // For standard template, topics are strings. For custom, they might be objects, but let's standardize.

                    const trackedSubject = syllabusState[subject.id] || {};

                    const hydratedTopics = subject.topics.map((t, idx) => {
                        const tTitle = typeof t === 'string' ? t : t.title || t.name;
                        const tId = typeof t === 'object' && t.id ? t.id : `${subject.id}_t${idx}`;
                        // Use topic title as key for persistence in standard data to avoid index issues if order changes, 
                        // but sticking to provided structure logic

                        return {
                            id: tId,
                            title: tTitle,
                            status: trackedSubject[tId] || 'not-started'
                        };
                    });

                    // Calculate Progress
                    const total = hydratedTopics.length;
                    const done = hydratedTopics.filter(t => t.status === 'done').length;
                    const progress = total === 0 ? 0 : Math.round((done / total) * 100);

                    return { ...subject, progress, topics: hydratedTopics };
                });
            }, [mode, syllabusState, user.customSyllabus]);

            const handleStatusChange = (subjectId, topicId, newStatus) => {
                setSyllabusState(prev => ({
                    ...prev,
                    [subjectId]: {
                        ...(prev[subjectId] || {}),
                        [topicId]: newStatus
                    }
                }));
                if (newStatus === 'done') log();
            };

            const handleAddTopic = (e) => {
                e.preventDefault();
                if (!customTopic.subject) return;

                const newSubject = {
                    id: `custom_${Date.now()}`,
                    name: customTopic.subject,
                    topics: customTopic.topic ? [{ id: `ct_${Date.now()}`, title: customTopic.topic }] : [],
                    mode: mode
                };

                update({ ...user, customSyllabus: [...(user.customSyllabus || []), newSubject] });
                setCustomTopic({ subject: '', topic: '' });
            };

            const toggleAccordion = (id) => {
                setExpandedSubjectId(expandedSubjectId === id ? null : id);
            };

            const statusColors = {
                'not-started': 'bg-slate-700/50 text-slate-400 border-slate-600/50',
                'in-progress': 'bg-amber-500/20 text-amber-400 border-amber-500/50 shadow-[0_0_10px_rgba(245,158,11,0.2)]',
                'done': 'bg-emerald-500/20 text-emerald-400 border-emerald-500/50 shadow-[0_0_10px_rgba(16,185,129,0.2)]'
            };

            return (
                <div className="space-y-8 animate-fade-in pb-12 w-full max-w-5xl mx-auto">
                    <div className="flex flex-col md:flex-row justify-between items-end gap-6 border-b border-white/5 pb-6">
                        <div>
                            <h2 className="text-4xl font-bold text-white tracking-tight">System Syllabus</h2>
                            <p className="text-slate-400 mt-2 font-mono text-xs">KNOWLEDGE GRAPH // {mode} PROTOCOL</p>
                        </div>

                        {/* MODE SWITCHER */}
                        <div className="bg-white/5 p-1 rounded-xl flex gap-1 border border-white/10 backdrop-blur-md">
                            {['GATE', 'PLACEMENT', 'INTERVIEW'].map(m => (
                                <button
                                    key={m}
                                    onClick={() => setMode(m)}
                                    className={`px-6 py-2.5 rounded-lg text-xs font-bold transition-all uppercase tracking-wider ${mode === m ? 'bg-brand-500 text-white shadow-lg' : 'text-slate-400 hover:text-white hover:bg-white/5'}`}
                                >
                                    {m}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* LINEAR PERFORMANCE TRACKER */}
                    <div className="space-y-3">
                        {displayData.map((item) => (
                            <div key={item.id} className="group overflow-hidden bg-surface-900/60 backdrop-blur-md border border-white/5 hover:border-brand-500/30 rounded-xl transition-all duration-300">
                                {/* MAIN ROW */}
                                <div className="p-4 relative">
                                    <div className="absolute inset-0 bg-gradient-to-r from-brand-500/0 via-brand-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"></div>
                                    <div className="flex flex-col md:flex-row items-center gap-6 relative z-10">
                                        {/* Left: Subject Name */}
                                        <div className="w-full md:w-1/4">
                                            <h3 className="font-bold text-white text-sm truncate">{item.name}</h3>
                                            <p className="text-[10px] text-slate-500 font-mono truncate">{item.topics.length} SUB-MODULES</p>
                                        </div>

                                        {/* Middle: Progress Bar */}
                                        <div className="flex-1 w-full flex items-center gap-4">
                                            <div className="h-2 w-full bg-black/50 rounded-full overflow-hidden border border-white/5 relative">
                                                <div className="absolute inset-0 z-10 opacity-20" style={{ backgroundImage: 'linear-gradient(to right, transparent 2px, #000 2px)', backgroundSize: '10px 100%' }}></div>
                                                <div
                                                    className="h-full bg-gradient-to-r from-brand-600 to-cyan-400 relative transition-all duration-1000 ease-out"
                                                    style={{ width: `${item.progress}%` }}
                                                >
                                                    <div className="absolute top-0 right-0 bottom-0 w-1 bg-white/50 animate-pulse"></div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Right: Stats & Action */}
                                        <div className="w-full md:w-auto flex items-center justify-between gap-6">
                                            <span className="font-mono font-bold text-brand-400 text-sm w-12 text-right">{item.progress}%</span>
                                            <button
                                                onClick={() => toggleAccordion(item.id)}
                                                className={`px-4 py-2 border rounded-lg text-[10px] font-bold uppercase tracking-widest transition-all flex items-center gap-2 group-hover:shadow-[0_0_15px_rgba(var(--brand-500),0.3)]
                                                    ${expandedSubjectId === item.id ? 'bg-brand-500 text-white border-brand-500' : 'bg-white/5 hover:bg-brand-500 hover:text-white border-white/10'}
                                                `}
                                            >
                                                {expandedSubjectId === item.id ? 'CLOSE' : 'ACCESS'} <Icon name={expandedSubjectId === item.id ? "chevron-up" : "chevron-right"} size={12} />
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                {/* ACCORDION CONTENT */}
                                <AnimatePresence>
                                    {expandedSubjectId === item.id && (
                                        <motion.div
                                            initial={{ height: 0, opacity: 0 }}
                                            animate={{ height: "auto", opacity: 1 }}
                                            exit={{ height: 0, opacity: 0 }}
                                            transition={{ duration: 0.3, ease: "easeInOut" }}
                                            className="overflow-hidden bg-black/40 border-t border-white/5"
                                        >
                                            <div className="p-4 grid grid-cols-1 md:grid-cols-2 gap-3">
                                                {item.topics.map((t) => (
                                                    <div key={t.id} className="flex items-center justify-between p-3 rounded-lg bg-white/5 border border-white/5 hover:border-white/10 transition-colors">
                                                        <span className="text-xs font-medium text-slate-300">{t.title}</span>
                                                        <div className="flex gap-1 bg-black/50 rounded-lg p-1">
                                                            {[
                                                                { v: 'not-started', l: '' },
                                                                { v: 'in-progress', l: '' },
                                                                { v: 'done', l: '' }
                                                            ].map(opt => (
                                                                <button
                                                                    key={opt.v}
                                                                    onClick={() => handleStatusChange(item.id, t.id, opt.v)}
                                                                    className={`w-6 h-6 flex items-center justify-center rounded transition-all hover:bg-white/10 ${t.status === opt.v ? 'bg-white/10 scale-110' : 'opacity-40 grayscale'}`}
                                                                    title={opt.v.replace('-', ' ')}
                                                                >
                                                                    <span className="text-xs">{opt.l}</span>
                                                                </button>
                                                            ))}
                                                        </div>
                                                    </div>
                                                ))}
                                                {item.topics.length === 0 && (
                                                    <div className="col-span-2 text-center py-4 text-xs text-slate-500 font-mono">NO SUB-MODULES DETECTED</div>
                                                )}
                                            </div>
                                        </motion.div>
                                    )}
                                </AnimatePresence>
                            </div>
                        ))}
                    </div>

                    {/* ADD TOPIC SECTION */}
                    <div className="mt-8 border-t border-white/5 pt-8">
                        <h3 className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4">Extend Knowledge Base</h3>
                        <form onSubmit={handleAddTopic} className="bg-white/5 border border-white/10 rounded-xl p-2 flex flex-col md:flex-row gap-2">
                            <input
                                value={customTopic.subject}
                                onChange={e => setCustomTopic({ ...customTopic, subject: e.target.value })}
                                placeholder="Subject Name"
                                className="bg-transparent px-4 py-2 text-sm text-white outline-none flex-1 placeholder:text-slate-600"
                            />
                            <div className="w-px bg-white/10 hidden md:block"></div>
                            <input
                                value={customTopic.topic}
                                onChange={e => setCustomTopic({ ...customTopic, topic: e.target.value })}
                                placeholder="Sub-topic (Optional)"
                                className="bg-transparent px-4 py-2 text-sm text-white outline-none flex-1 placeholder:text-slate-600"
                            />
                            <button type="submit" className="px-6 py-2 bg-brand-500/20 text-brand-400 border border-brand-500/30 rounded-lg text-xs font-bold uppercase hover:bg-brand-500 hover:text-white transition-all">
                                + Add Module
                            </button>
                        </form>
                    </div>
                </div>
            )
        };
        const Kanban = ({ user, update, log }) => {
            const [txt, setTxt] = useState("");
            const [filter, setFilter] = useState("ALL");

            const move = (id, f, t) => { const task = user.kanban[f].find(i => i.id === id); update({ ...user, kanban: { ...user.kanban, [f]: user.kanban[f].filter(i => i.id !== id), [t]: [task, ...user.kanban[t]] } }); if (t === 'done') log(); };
            const add = (e) => { e.preventDefault(); if (!txt) return; update({ ...user, kanban: { ...user.kanban, todo: [{ id: Date.now(), title: txt }, ...user.kanban.todo] } }); setTxt(""); };
            const del = (id, c) => update({ ...user, kanban: { ...user.kanban, [c]: user.kanban[c].filter(i => i.id !== id) } });

            // Helper to render a task card
            const TaskCard = ({ t, category }) => (
                <div key={t.id} className="group flex items-center gap-3 p-4 bg-white/5 border border-white/10 rounded-xl hover:border-brand-500/30 transition-all backdrop-blur-sm active:scale-[0.98]">
                    {/* Checkbox (Left) */}
                    <button
                        onClick={() => category !== 'done' ? move(t.id, category, 'done') : move(t.id, category, 'todo')}
                        className={`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all flex-shrink-0 ${category === 'done' ? 'bg-emerald-500 border-emerald-500' : 'border-slate-500 hover:border-brand-400'}`}
                    >
                        {category === 'done' && <Icon name="check" size={14} className="text-black" />}
                    </button>

                    {/* Text (Middle) */}
                    <div className={`flex-1 text-sm font-medium ${category === 'done' ? 'text-slate-500 line-through' : 'text-slate-200'}`}>
                        {t.title}
                    </div>

                    {/* Actions / Priority (Right) */}
                    <div className="flex items-center gap-2">
                        <div className={`w-2 h-2 rounded-full ${t.id % 2 === 0 ? 'bg-red-500 shadow-[0_0_5px_rgba(239,68,68,0.5)]' : 'bg-blue-500 shadow-[0_0_5px_rgba(59,130,246,0.5)]'}`}></div>
                        <button onClick={() => del(t.id, category)} className="text-slate-600 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity p-1">
                            <Icon name="trash-2" size={16} />
                        </button>
                    </div>
                </div>
            );

            return (
                <div className="h-full relative flex flex-col max-w-2xl mx-auto animate-fade-in">
                    {/* Header with Title & Pills */}
                    <div className="flex flex-col gap-4 mb-4 pt-2">
                        <div className="flex justify-between items-end px-1">
                            <div>
                                <h2 className="text-3xl font-bold text-white tracking-tight">Task Manager</h2>
                                <p className="text-slate-400 text-xs font-mono uppercase tracking-widest">{user.kanban.todo.length} PENDING // {user.kanban.doing.length} IN PROGRESS</p>
                            </div>
                        </div>

                        {/* Pills */}
                        <div className="flex gap-2 overflow-x-auto pb-2 custom-scrollbar no-scrollbar">
                            {['ALL', 'WORK', 'DSA', 'PERSONAL'].map(f => (
                                <button
                                    key={f}
                                    onClick={() => setFilter(f)}
                                    className={`px-4 py-1.5 rounded-full text-[10px] font-bold uppercase tracking-wider white-space-nowrap transition-all border ${filter === f ? 'bg-brand-500 text-white border-brand-500 shadow-lg' : 'bg-white/5 border-white/10 text-slate-400 hover:text-white'}`}
                                >
                                    {f}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Task List Container */}
                    <div className="flex-1 overflow-y-auto pb-32 space-y-3 custom-scrollbar px-1">
                        {/* IN PROGRESS */}
                        {user.kanban.doing.length > 0 && (
                            <div className="space-y-2 mb-4">
                                <h3 className="text-xs font-bold text-brand-400 uppercase tracking-widest ml-1 opacity-70">In Focus</h3>
                                {user.kanban.doing.map(t => <TaskCard key={t.id} t={t} category="doing" />)}
                            </div>
                        )}

                        {/* TODO */}
                        <div className="space-y-2">
                            <h3 className="text-xs font-bold text-slate-500 uppercase tracking-widest ml-1 opacity-70">Backlog</h3>
                            {user.kanban.todo.map(t => <TaskCard key={t.id} t={t} category="todo" />)}
                            {user.kanban.todo.length === 0 && user.kanban.doing.length === 0 && (
                                <div className="text-center py-12 border border-dashed border-white/10 rounded-2xl">
                                    <p className="text-slate-500 text-sm">No active tasks. System idle.</p>
                                </div>
                            )}
                        </div>

                        {/* COMPLETED */}
                        {user.kanban.done.length > 0 && (
                            <div className="space-y-2 mt-8 opacity-60">
                                <h3 className="text-xs font-bold text-emerald-500/70 uppercase tracking-widest ml-1">Completed</h3>
                                {user.kanban.done.map(t => <TaskCard key={t.id} t={t} category="done" />)}
                            </div>
                        )}
                    </div>

                    {/* Floating Input (Glass Bar) */}
                    <div className="absolute bottom-0 left-0 right-0 p-4 pb-6 bg-gradient-to-t from-[#05050a] via-[#05050a]/90 to-transparent z-20">
                        <form onSubmit={add} className="bg-white/10 backdrop-blur-xl border border-white/10 p-2 rounded-full flex items-center gap-2 shadow-[0_0_30px_rgba(0,0,0,0.5)] ring-1 ring-white/5">
                            <div className="w-8 h-8 rounded-full bg-brand-500/20 text-brand-400 flex items-center justify-center border border-brand-500/30">
                                <Icon name="plus" size={16} />
                            </div>
                            <input
                                value={txt}
                                onChange={e => setTxt(e.target.value)}
                                placeholder="Add new neutral task..."
                                className="flex-1 bg-transparent border-none outline-none text-white text-sm placeholder:text-slate-500 h-10"
                            />
                            <button
                                type="submit"
                                disabled={!txt}
                                className="px-5 py-2 bg-brand-500 hover:bg-brand-400 text-black font-bold text-xs rounded-full uppercase tracking-wider transition-all disabled:opacity-0 disabled:scale-90 shadow-[0_0_15px_rgba(var(--brand-500),0.4)]"
                            >
                                Add
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        const Flashcards = ({ user, update, log }) => {
            const { motion, AnimatePresence, useMotionValue, useSpring, useTransform } = window.Motion;
            const [add, setAdd] = useState(false);
            const [nC, setNC] = useState({ f: '', b: '' });

            const today = new Date().toISOString().split('T')[0];
            const due = (user.flashcards || []).filter(c => !c.next || c.next <= today);

            const rate = (d) => {
                const c = due[0];
                let n = new Date();
                n.setDate(n.getDate() + d);
                update({ ...user, flashcards: [...user.flashcards.filter(x => x.id !== c.id), { ...c, next: n.toISOString().split('T')[0] }] });
                if (due.length === 1) log();
            };

            const create = (e) => {
                e.preventDefault();
                update({ ...user, flashcards: [...(user.flashcards || []), { id: Date.now(), f: nC.f, b: nC.b, next: today }] });
                setAdd(false);
                setNC({ f: '', b: '' });
            };

            const NeuralFlashcard = ({ front, back, onRate }) => {
                const x = useMotionValue(0);
                const y = useMotionValue(0);
                const mouseX = useSpring(x, { stiffness: 150, damping: 15 });
                const mouseY = useSpring(y, { stiffness: 150, damping: 15 });
                const [isFlipped, setIsFlipped] = useState(false);

                function handleMouseMove({ currentTarget, clientX, clientY }) {
                    const { left, top, width, height } = currentTarget.getBoundingClientRect();
                    x.set(clientX - left - width / 2);
                    y.set(clientY - top - height / 2);
                }

                function handleMouseLeave() {
                    x.set(0);
                    y.set(0);
                }

                return (
                    <motion.div
                        onMouseMove={handleMouseMove}
                        onMouseLeave={handleMouseLeave}
                        style={{
                            rotateX: useTransform(mouseY, [-100, 100], [10, -10]),
                            rotateY: useTransform(mouseX, [-100, 100], [-10, 10]),
                            transformStyle: "preserve-3d",
                        }}
                        className="w-full h-96 cursor-pointer relative perspective-1000"
                        onClick={() => setIsFlipped(!isFlipped)}
                    >
                        <motion.div
                            animate={{ rotateY: isFlipped ? 180 : 0 }}
                            transition={{ duration: 0.6 }}
                            style={{ transformStyle: "preserve-3d" }}
                            className="w-full h-full relative"
                        >
                            <div className="absolute inset-0 backface-hidden holo-card rounded-3xl flex flex-col items-center justify-center p-12 text-center border-t border-white/20 bg-[#05050a]" style={{ backfaceVisibility: 'hidden' }}>
                                <div className="text-xs font-mono text-slate-500 uppercase tracking-widest mb-6">Question</div>
                                <div className="text-3xl font-bold text-white">{front}</div>
                                <div className="absolute bottom-6 text-brand-400 text-xs animate-pulse">Click to Reveal</div>
                            </div>

                            <div className="absolute inset-0 backface-hidden holo-card rounded-3xl flex flex-col items-center justify-center p-12 text-center bg-brand-900/20 border-brand-500/30"
                                style={{ backfaceVisibility: 'hidden', transform: 'rotateY(180deg)' }}>
                                <div className="text-xs font-mono text-brand-400 uppercase tracking-widest mb-6">Answer</div>
                                <div className="text-2xl font-medium text-white mb-10">{back}</div>
                                <div className="flex gap-4 absolute bottom-8 z-20" onClick={e => e.stopPropagation()}>
                                    <button onClick={() => onRate(1)} className="px-6 py-2 rounded-lg bg-red-500/20 text-red-300 border border-red-500/30 hover:bg-red-500 hover:text-white font-bold text-xs uppercase transition-colors">Hard</button>
                                    <button onClick={() => onRate(3)} className="px-6 py-2.5 rounded-lg bg-emerald-500/20 text-emerald-300 border border-emerald-500/30 hover:bg-emerald-500 hover:text-white font-bold text-[10px] uppercase transition-colors tracking-widest">Easy</button>
                                </div>
                            </div>
                        </motion.div>
                    </motion.div>
                );
            };

            return (
                <div className="max-w-2xl mx-auto space-y-8 animate-fade-in">
                    <div className="flex justify-between items-center"><h2 className="text-3xl font-bold text-white">Neural Recall</h2><Button onClick={() => setAdd(!add)} icon="plus">Create</Button></div>
                    {add && <Card className="border-brand-500/30"><form onSubmit={create} className="space-y-4"><input value={nC.f} onChange={e => setNC({ ...nC, f: e.target.value })} placeholder="Front (Question)" className="w-full bg-black/50 border border-white/10 rounded-xl p-3 text-white outline-none focus:border-brand-500" /><input value={nC.b} onChange={e => setNC({ ...nC, b: e.target.value })} placeholder="Back (Answer)" className="w-full bg-black/50 border border-white/10 rounded-xl p-3 text-white outline-none focus:border-brand-500" /><Button type="submit" className="w-full">Save to Deck</Button></form></Card>}
                    {due.length > 0 ? (
                        <NeuralFlashcard key={due[0].id} front={due[0].f} back={due[0].b} onRate={rate} />
                    ) : (
                        <div className="text-center py-20 holo-card rounded-3xl border-dashed border-slate-700"><div className="w-16 h-16 bg-emerald-500/10 rounded-full flex items-center justify-center mx-auto mb-4 text-emerald-400"><Icon name="check" size={32} /></div><h3 className="text-xl font-bold text-white">Review Complete</h3><p className="text-slate-400 mt-2">Neural pathways reinforced.</p></div>
                    )}
                </div>
            )
        };

        /* --- VAULT COMPONENT (UPDATED) --- */
        const Vault = ({ user, update, setTab }) => {
            const [f, setF] = useState({ t: '', l: '' });
            const add = (e) => { e.preventDefault(); if (!f.t) return; update({ ...user, resources: [{ id: Date.now(), ...f }, ...(user.resources || [])] }); setF({ t: '', l: '' }); };

            const VaultCard = ({ resource, onDelete }) => (
                <div className="holo-card p-0 rounded-2xl group relative overflow-hidden flex flex-col h-full bg-surface-900/40">
                    <div className="h-32 w-full overflow-hidden relative">
                        <img
                            src={resource.img || `https://source.unsplash.com/random/400x200/?cyberpunk,code,${resource.id}`}
                            alt="Cover"
                            className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 opacity-80 group-hover:opacity-100"
                        />
                        <div className="absolute inset-0 bg-gradient-to-t from-[#0a0a0f] to-transparent"></div>
                        <div className="absolute bottom-2 left-3">
                            <span className="px-2 py-0.5 rounded-full bg-brand-500/20 border border-brand-500/30 text-[10px] font-bold text-brand-400 uppercase tracking-widest backdrop-blur-md">Decrypted</span>
                        </div>
                    </div>
                    <div className="p-5 flex-1 flex flex-col">
                        <h3 className="text-lg font-bold text-white mb-1 group-hover:text-brand-400 transition-colors leading-tight">{resource.t}</h3>
                        <div className="text-xs text-slate-500 font-mono mb-4 flex-1 truncate">{resource.l}</div>
                        <div className="flex justify-between items-center mt-auto pt-4 border-t border-white/5">
                            <span className="text-[10px] text-slate-600 font-mono">{new Date(resource.id).toLocaleDateString()}</span>
                            <div className="flex gap-2">
                                <a href={resource.l} target="_blank" className="p-2 rounded-lg bg-white/5 hover:bg-brand-500 hover:text-white text-slate-400 transition-colors"><Icon name="external-link" size={14} /></a>
                                <button onClick={onDelete} className="p-2 rounded-lg bg-white/5 hover:bg-red-500 hover:text-white text-slate-400 transition-colors"><Icon name="trash-2" size={14} /></button>
                            </div>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="space-y-12 animate-fade-in pb-12">
                    <div className="flex justify-between items-end">
                        <div className="space-y-2">
                            <div className="flex items-center gap-3 mb-2"><span className="px-2 py-0.5 rounded bg-brand-500/20 text-brand-400 text-[10px] font-bold uppercase tracking-widest border border-brand-500/30">Lvl 3  Access Granted</span></div>
                            <h2 className="text-4xl font-bold text-white tracking-tight">Data Vault</h2>
                            <p className="text-slate-400 font-mono text-xs">SECURE STORAGE // ENCRYPTED FRAGMENTS</p>
                        </div>
                    </div>

                    {/* CORE MODULES */}
                    <div>
                        <h3 className="text-sm font-bold text-white uppercase tracking-widest mb-6 flex items-center gap-2"><Icon name="cpu" size={16} className="text-brand-400" /> Core Modules</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            {/* DSA Card */}
                            <div onClick={() => setTab('dsa')} className="holo-card p-6 rounded-2xl group cursor-pointer relative overflow-hidden border-emerald-500/30 hover:border-emerald-500/60 h-48 flex flex-col justify-end bg-gradient-to-br from-emerald-900/10 to-black">
                                <div className="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1555066931-4365d14bab8c?auto=format&fit=crop&q=80')] opacity-20 group-hover:opacity-40 transition-opacity bg-cover bg-center"></div>
                                <div className="absolute top-4 right-4 p-2 rounded-lg bg-emerald-500/20 text-emerald-400 border border-emerald-500/30"><Icon name="binary" size={24} /></div>
                                <div className="relative z-10">
                                    <h3 className="text-2xl font-bold text-white mb-2">Velosify DSA Sheet</h3>
                                    <p className="text-emerald-400 font-mono text-xs uppercase tracking-widest">Day 1 & 2 Decrypted</p>
                                </div>
                            </div>

                            {/* HR Prep Card */}
                            <div onClick={() => setTab('hr-prep')} className="holo-card p-6 rounded-2xl group cursor-pointer relative overflow-hidden border-pink-500/30 hover:border-pink-500/60 h-48 flex flex-col justify-end bg-gradient-to-br from-pink-900/10 to-black">
                                <div className="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1521737604893-d14cc237f11d?auto=format&fit=crop&q=80')] opacity-20 group-hover:opacity-40 transition-opacity bg-cover bg-center"></div>
                                <div className="absolute top-4 right-4 p-2 rounded-lg bg-pink-500/20 text-pink-400 border border-pink-500/30"><Icon name="users" size={24} /></div>
                                <div className="relative z-10">
                                    <h3 className="text-2xl font-bold text-white mb-2">HR Protocol</h3>
                                    <p className="text-pink-400 font-mono text-xs uppercase tracking-widest">Behavioral Analysis</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* USER RESOURCES */}
                    <div>
                        <h3 className="text-sm font-bold text-white uppercase tracking-widest mb-6 flex items-center gap-2"><Icon name="database" size={16} className="text-brand-400" /> Encrypted Fragments</h3>

                        <Card className="border-brand-500/20 bg-brand-900/5 mb-8">
                            <form onSubmit={add} className="flex flex-col md:flex-row gap-4 items-end">
                                <div className="flex-1 w-full space-y-2">
                                    <label className="text-[10px] uppercase font-bold text-brand-400 tracking-widest pl-1">Resource Title</label>
                                    <input value={f.t} onChange={e => setF({ ...f, t: e.target.value })} placeholder="Ex: System Design Notes" className="w-full bg-black/50 border border-white/10 p-3 rounded-xl text-white outline-none focus:border-brand-500 transition-all font-medium text-sm" />
                                </div>
                                <div className="flex-1 w-full space-y-2">
                                    <label className="text-[10px] uppercase font-bold text-brand-400 tracking-widest pl-1">Target URL</label>
                                    <input value={f.l} onChange={e => setF({ ...f, l: e.target.value })} placeholder="https://..." className="w-full bg-black/50 border border-white/10 p-3 rounded-xl text-white outline-none focus:border-brand-500 transition-all font-mono text-sm" />
                                </div>
                                <Button type="submit" icon="lock" className="w-full md:w-auto h-[46px] mb-[1px]">Encrypt</Button>
                            </form>
                        </Card>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {(user.resources || []).map(r => (
                                <VaultCard key={r.id} resource={r} onDelete={(e) => { e.preventDefault(); e.stopPropagation(); update({ ...user, resources: user.resources.filter(x => x.id !== r.id) }); }} />
                            ))}
                            {(user.resources || []).length === 0 && (
                                <div className="col-span-full py-12 text-center border border-dashed border-white/10 rounded-2xl bg-white/5">
                                    <Icon name="folder-open" size={32} className="text-slate-600 mb-3 mx-auto" />
                                    <p className="text-slate-500 text-sm font-mono">No encrypted fragments found.</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            )
        };


























        /* --- DATA & CONTENT --- */
        const DSA_MASTER_DATA = [
            {
                id: "arrays",
                label: "Arrays & RAM",
                position: { x: 150, y: 100 },
                status: "unlocked",
                learningContent: {
                    title: "Arrays & Memory Architecture",
                    summary: "The fundamental building block of data storage. Elements stored in contiguous memory.",
                    deepDive: `### Internal Memory Layout
        When you declare \`int arr[5]\`, the OS allocates a *continuous* block of memory. 
        If the base address is 1000 and integer size is 4 bytes, the elements are at:
        - \`arr[0]\`: 1000
        - \`arr[1]\`: 1004
        - \`arr[2]\`: 1008
        ...
        This allows the CPU to fetch data using the formula: 
        > \`Address = Base + (Index * Size)\`
        
        **Why is this important?**
        1. **O(1) Random Access:** No iteration needed.
        2. **Spatial Locality:** CPU caches load chunks of memory. Arrays are cache-friendly.`,
                    complexityAnalysis: {
                        access: "O(1) - The fastest possible look-up.",
                        search: "O(n) - Must scan one by one (if unsorted).",
                        insertion: "O(n) - Must shift subsequent elements.",
                        deletion: "O(n) - Must shift to fill the gap.",
                        space: "O(n) - Strictly linear."
                    },
                    realWorldApplications: [
                        "Basis for Hash Tables (Buckets).",
                        "Image Buffers (Pixels stored linearly).",
                        "Matrix Operations in Machine Learning."
                    ],
                    pitfalls: [
                        "Index Out Of Bounds (#1 Error).",
                        "Memory Fragmentation (Large arrays need contiguous blocks).",
                        "Fixed size limits (in low-level languages)."
                    ],
                    codeSnippets: {
                        python: `# Dynamic Array (List)
        import sys
        arr = [1, 2, 3]
        # Python lists store POINTERS to objects, not raw values.
        # This adds overhead but allows mixed types.`,
                        java: `// Static Array
        int[] arr = new int[5]; // Fast, stack-allocated references.
        
        // Dynamic Array
        ArrayList<Integer> list = new ArrayList<>(); // Resizes by 1.5x`,
                        cpp: `// Raw Array
        int arr[5]; 
        
        // Vector (Dynamic)
        std::vector<int> v; 
        // Uses doubling strategy when capacity is reached.`
                    }
                },
                questions: [
                    { id: "arr_1", title: "Two Sum", link: "https://leetcode.com/problems/two-sum/", difficulty: "Easy", xp: 10 },
                    { id: "arr_2", title: "Best Time to Buy and Sell Stock", link: "https://leetcode.com/problems/best-time-to-buy-and-sell-stock/", difficulty: "Easy", xp: 10 },
                    { id: "arr_3", title: "Contains Duplicate", link: "https://leetcode.com/problems/contains-duplicate/", difficulty: "Easy", xp: 10 },
                    { id: "arr_4", title: "Product of Array Except Self", link: "https://leetcode.com/problems/product-of-array-except-self/", difficulty: "Medium", xp: 20 },
                    { id: "arr_5", title: "Maximum Subarray", link: "https://leetcode.com/problems/maximum-subarray/", difficulty: "Medium", xp: 20 },
                    { id: "arr_6", title: "Maximum Product Subarray", link: "https://leetcode.com/problems/maximum-product-subarray/", difficulty: "Medium", xp: 20 },
                    { id: "arr_7", title: "Find Minimum in Rotated Sorted Array", link: "https://leetcode.com/problems/find-minimum-in-rotated-sorted-array/", difficulty: "Medium", xp: 20 },
                    { id: "arr_8", title: "Search in Rotated Sorted Array", link: "https://leetcode.com/problems/search-in-rotated-sorted-array/", difficulty: "Medium", xp: 20 },
                    { id: "arr_9", title: "3Sum", link: "https://leetcode.com/problems/3sum/", difficulty: "Medium", xp: 20 },
                    { id: "arr_10", title: "Container With Most Water", link: "https://leetcode.com/problems/container-with-most-water/", difficulty: "Medium", xp: 20 }
                ]
            },
            {
                id: "linkedlist",
                label: "Linked Lists",
                position: { x: 300, y: 300 },
                dependencies: ["arrays"],
                status: "unlocked",
                learningContent: {
                    title: "Linked Lists & Pointers",
                    summary: "Nodes scattered in memory, connected by references (pointers). Dynamic and flexible.",
                    deepDive: `### The Pointer Chain
        Unlike arrays, Linked Lists do strictly **NOT** require contiguous memory. Each node contains:
        1. \`Data\`: The value.
        2. \`Next\`: Address of the next node.
        
        **Visualizing structure:**
        \`[Head: 1000] -> [Data: 5 | Next: 5020] -> [Data: 8 | Next: 200] -> NULL\`
        
        **Why use them?**
        - **Dynamic Size:** No pre-allocation needed.
        - **Efficient Insertions:** \`O(1)\` if you have the pointer (no shifting).`,
                    complexityAnalysis: {
                        access: "O(n) - Must traverse from Head.",
                        search: "O(n) - Linearly follow pointers.",
                        insertion: "O(1) - Just rewire pointers (at head/known location).",
                        deletion: "O(1) - Rewire pointers.",
                        space: "O(n) - Extra memory for pointers."
                    },
                    realWorldApplications: [
                        "Browser History (Back/Forward).",
                        "Undo/Redo Functionality (Stacks).",
                        "Blockchains (Hash Pointers link blocks)."
                    ],
                    pitfalls: [
                        "Losing the Head reference (Memory Leak).",
                        "Null Pointer Exceptions (Segfaults).",
                        "Poor Cache Locality (Scanning is slow)."
                    ],
                    codeSnippets: {
                        python: `class ListNode:
            def __init__(self, val=0, next=None):
                self.val = val
                self.next = next
        
        head = ListNode(1)
        head.next = ListNode(2)`,
                        java: `class Node {
            int data;
            Node next;
        }
        // Java's Garbage Collector handles deleted nodes automatically.`,
                        cpp: `struct Node {
            int data;
            Node* next;
        };
        // Manual memory management required (delete node).`
                    }
                },
                questions: [
                    { id: "ll_1", title: "Reverse Linked List", link: "https://leetcode.com/problems/reverse-linked-list/", difficulty: "Easy", xp: 10 },
                    { id: "ll_2", title: "Merge Two Sorted Lists", link: "https://leetcode.com/problems/merge-two-sorted-lists/", difficulty: "Easy", xp: 10 },
                    { id: "ll_3", title: "Reorder List", link: "https://leetcode.com/problems/reorder-list/", difficulty: "Medium", xp: 20 },
                    { id: "ll_4", title: "Remove Nth Node From End of List", link: "https://leetcode.com/problems/remove-nth-node-from-end-of-list/", difficulty: "Medium", xp: 20 },
                    { id: "ll_5", title: "Copy List with Random Pointer", link: "https://leetcode.com/problems/copy-list-with-random-pointer/", difficulty: "Medium", xp: 20 },
                    { id: "ll_6", title: "Add Two Numbers", link: "https://leetcode.com/problems/add-two-numbers/", difficulty: "Medium", xp: 20 },
                    { id: "ll_7", title: "Linked List Cycle", link: "https://leetcode.com/problems/linked-list-cycle/", difficulty: "Easy", xp: 10 },
                    { id: "ll_8", title: "Find the Duplicate Number", link: "https://leetcode.com/problems/find-the-duplicate-number/", difficulty: "Medium", xp: 20 },
                    { id: "ll_9", title: "LRU Cache", link: "https://leetcode.com/problems/lru-cache/", difficulty: "Medium", xp: 20 },
                    { id: "ll_10", title: "Merge K Sorted Lists", link: "https://leetcode.com/problems/merge-k-sorted-lists/", difficulty: "Hard", xp: 50 }
                ]
            },
            {
                id: "recursion",
                label: "Recursion",
                position: { x: 450, y: 100 },
                status: "unlocked",
                learningContent: {
                    title: "Recursion & The Stack",
                    summary: "Solving problems by breaking them into smaller, self-similar sub-problems.",
                    deepDive: `### The Call Stack Visualization
        Every recursive call pushes a new **Stack Frame** onto memory.
        Frame contains:
            - Local variables
            - Return address
            - Parameters
        
        **Example: Factorial(3)**
        1. \`fact(3)\` -> pushes to stack. Calls \`fact(2)\`.
        2. \`fact(2)\` -> pushes. Calls \`fact(1)\`.
        3. \`fact(1)\` -> Base case! Returns 1.
        4. \`fact(2)\` resumes. Returns 2 * 1.
        5. \`fact(3)\` resumes. Returns 3 * 2.
        
        **Key Rule:**
        Always define a **Base Case** to stop the recursion, otherwise: \`StackOverflowError\`.`,
                    complexityAnalysis: {
                        access: "N/A - It's a method.",
                        search: "O(n) - Depth of recursion tree.",
                        insertion: "N/A",
                        deletion: "N/A",
                        space: "O(h) - Height of the recursion tree (Stack depth)."
                    },
                    realWorldApplications: [
                        "DOM Tree Traversal (HTML Parsing).",
                        "JSON Serialization/Deserialization.",
                        "Divide & Conquer Algorithms (Merge Sort, Quick Sort)."
                    ],
                    pitfalls: [
                        "Stack Overflow (Infinite Recursion).",
                        "Re-calculating same states (Fix with Memoization/DP).",
                        "High memory overhead compared to Iteration."
                    ],
                    codeSnippets: {
                        python: `def factorial(n):
            if n <= 1: return 1 # Base Case
            return n * factorial(n-1) # Recursive Case`,
                        java: `public int fib(int n) {
            if (n <= 1) return n;
            return fib(n-1) + fib(n-2);
        }`,
                        cpp: `int dfs(Node* root) {
            if (!root) return 0;
            return 1 + max(dfs(root->left), dfs(root->right));
        }`
                    }
                },
                questions: [
                    { id: "rec_1", title: "Climbing Stairs", link: "https://leetcode.com/problems/climbing-stairs/", difficulty: "Easy", xp: 10 },
                    { id: "rec_2", title: "Fibonacci Number", link: "https://leetcode.com/problems/fibonacci-number/", difficulty: "Easy", xp: 10 },
                    { id: "rec_3", title: "Reverse String", link: "https://leetcode.com/problems/reverse-string/", difficulty: "Easy", xp: 10 },
                    { id: "rec_4", title: "Power of Two", link: "https://leetcode.com/problems/power-of-two/", difficulty: "Easy", xp: 10 },
                    { id: "rec_5", title: "Power of Three", link: "https://leetcode.com/problems/power-of-three/", difficulty: "Easy", xp: 10 },
                    { id: "rec_6", title: "Power of Four", link: "https://leetcode.com/problems/power-of-four/", difficulty: "Easy", xp: 10 },
                    { id: "rec_7", title: "Merge Two Sorted Lists", link: "https://leetcode.com/problems/merge-two-sorted-lists/", difficulty: "Easy", xp: 10 },
                    { id: "rec_8", title: "Swap Nodes in Pairs", link: "https://leetcode.com/problems/swap-nodes-in-pairs/", difficulty: "Medium", xp: 20 },
                    { id: "rec_9", title: "Pascals Triangle", link: "https://leetcode.com/problems/pascals-triangle/", difficulty: "Easy", xp: 10 },
                    { id: "rec_10", title: "Pow(x, n)", link: "https://leetcode.com/problems/powx-n/", difficulty: "Medium", xp: 20 }
                ]
            },
            {
                id: "strings",
                label: "String Ops",
                status: "unlocked",
                learningContent: {
                    title: "Strings & Manipulation",
                    summary: "Strings are sequences of characters. Mastering them requires understanding immutability and memory/ASCII layouts.",
                    deepDive: `### String Internals
In many languages (Java, Python, C#), strings are **Immutable**. 
This means simplifying iterating \`s += 'a'\` creates a NEW string every time, leading to \`O(n^2)\` complexity.

**Key Techniques:**
1. **Two Pointers:** Process from both ends (Palindromes).
2. **Sliding Window:** Find substrings satisfying conditions.
3. **Hashing:** Count characters (Anagrams).

**StringBuilder / StringBuffer:**
Always use a mutable buffer for building strings in loops to keep operations \`O(n)\`.`,
                    complexityAnalysis: {
                        access: "O(1) - Index access.",
                        search: "O(n) - Scan for character.",
                        concatenation: "O(n) - Copying characters (if immutable).",
                        space: "O(n) - Storage."
                    },
                    realWorldApplications: [
                        "Text Processing & Editors.",
                        "URL Handling & Routing.",
                        "Bioinformatics (DNA Sequences)."
                    ],
                    pitfalls: [
                        "String Concatenation in Loops (Performance killer).",
                        "Ignoring Unicode/Multi-byte characters.",
                        "Off-by-one errors in substrings."
                    ],
                    codeSnippets: {
                        python: `# Checking Palindrome efficiently
def isPalindrome(s):
    l, r = 0, len(s) - 1
    while l < r:
        if s[l] != s[r]: return False
        l += 1; r -= 1
    return True`,
                        java: `// Efficient concatenation
StringBuilder sb = new StringBuilder();
for (int i = 0; i < 100; i++) {
    sb.append(i);
}
String res = sb.toString();`,
                        cpp: `// std::string is mutable
string s = "Hello";
s += " World"; // Efficient append
sort(s.begin(), s.end());`
                    }
                },
                questions: [
                    { id: "str_1", title: "Valid Palindrome", link: "https://leetcode.com/problems/valid-palindrome/", difficulty: "Easy", xp: 10 },
                    { id: "str_2", title: "Valid Anagram", link: "https://leetcode.com/problems/valid-anagram/", difficulty: "Easy", xp: 10 },
                    { id: "str_3", title: "Longest Substring Without Repeating Characters", link: "https://leetcode.com/problems/longest-substring-without-repeating-characters/", difficulty: "Medium", xp: 20 },
                    { id: "str_4", title: "Longest Repeating Character Replacement", link: "https://leetcode.com/problems/longest-repeating-character-replacement/", difficulty: "Medium", xp: 20 },
                    { id: "str_5", title: "Group Anagrams", link: "https://leetcode.com/problems/group-anagrams/", difficulty: "Medium", xp: 20 },
                    { id: "str_6", title: "Valid Parentheses", link: "https://leetcode.com/problems/valid-parentheses/", difficulty: "Easy", xp: 10 },
                    { id: "str_7", title: "Longest Palindromic Substring", link: "https://leetcode.com/problems/longest-palindromic-substring/", difficulty: "Medium", xp: 20 },
                    { id: "str_8", title: "Palindromic Substrings", link: "https://leetcode.com/problems/palindromic-substrings/", difficulty: "Medium", xp: 20 },
                    { id: "str_9", title: "Encode and Decode Strings", link: "https://leetcode.com/problems/encode-and-decode-strings/", difficulty: "Medium", xp: 20 },
                    { id: "str_10", title: "Minimum Window Substring", link: "https://leetcode.com/problems/minimum-window-substring/", difficulty: "Hard", xp: 50 }
                ]
            },
            {
                id: "trees",
                label: "Trees & BST",
                status: "unlocked",
                learningContent: {
                    title: "Binary Trees & BSTs",
                    summary: "Hierarchical structures ideal for sorting and searching. Recursive by nature.",
                    deepDive: `### Tree Anatomy
- **Root:** The top node.
- **Leaf:** Node with no children.
- **Height:** Max depth from root to leaf.

**Binary Search Tree (BST):**
Left child < Parent < Right child.
This property enables \`O(log n)\` search, similar to Binary Search on arrays, but with dynamic structure.

**Traversals:**
1. **In-Order:** Left -> Root -> Right (Sorted order in BST).
2. **Pre-Order:** Root -> Left -> Right (Cloning).
3. **Post-Order:** Left -> Right -> Root (Deletion/Math eval).`,
                    complexityAnalysis: {
                        access: "O(log n) - Balanced BST.",
                        search: "O(log n) - Balanced BST.",
                        insertion: "O(log n) - Balanced BST.",
                        deletion: "O(log n) - Balanced BST."
                    },
                    realWorldApplications: [
                        "File Systems (Folders/Files).",
                        "Database Indexing (B-Trees).",
                        "HTML DOM Structure."
                    ],
                    pitfalls: [
                        "Unbalanced Trees (Degenerate to Linked List O(n)).",
                        "Recursion Depth causing Stack Overflow.",
                        "Modifying a BST while iterating."
                    ],
                    codeSnippets: {
                        python: `# Definition for a binary tree node.
class TreeNode:
    def __init__(self, val=0, left=None, right=None):
        self.val = val
        self.left = left
        self.right = right`,
                        java: `// In-order Traversal
void printInOrder(Node node) {
    if (node == null) return;
    printInOrder(node.left);
    System.out.print(node.val + " ");
    printInOrder(node.right);
}`,
                        cpp: `// BST Insert
Node* insert(Node* node, int data) {
    if (!node) return new Node(data);
    if (data < node->data) node->left = insert(node->left, data);
    else if (data > node->data) node->right = insert(node->right, data);
    return node;
}`
                    }
                },
                questions: [
                    { id: "tr_1", title: "Invert Binary Tree", link: "https://leetcode.com/problems/invert-binary-tree/", difficulty: "Easy", xp: 10 },
                    { id: "tr_2", title: "Maximum Depth of Binary Tree", link: "https://leetcode.com/problems/maximum-depth-of-binary-tree/", difficulty: "Easy", xp: 10 },
                    { id: "tr_3", title: "Diameter of Binary Tree", link: "https://leetcode.com/problems/diameter-of-binary-tree/", difficulty: "Easy", xp: 10 },
                    { id: "tr_4", title: "Balanced Binary Tree", link: "https://leetcode.com/problems/balanced-binary-tree/", difficulty: "Easy", xp: 10 },
                    { id: "tr_5", title: "Same Tree", link: "https://leetcode.com/problems/same-tree/", difficulty: "Easy", xp: 10 },
                    { id: "tr_6", title: "Subtree of Another Tree", link: "https://leetcode.com/problems/subtree-of-another-tree/", difficulty: "Easy", xp: 10 },
                    { id: "tr_7", title: "Lowest Common Ancestor of a BST", link: "https://leetcode.com/problems/lowest-common-ancestor-of-a-binary-search-tree/", difficulty: "Medium", xp: 20 },
                    { id: "tr_8", title: "Binary Tree Level Order Traversal", link: "https://leetcode.com/problems/binary-tree-level-order-traversal/", difficulty: "Medium", xp: 20 },
                    { id: "tr_9", title: "Validate Binary Search Tree", link: "https://leetcode.com/problems/validate-binary-search-tree/", difficulty: "Medium", xp: 20 },
                    { id: "tr_10", title: "Kth Smallest Element in a BST", link: "https://leetcode.com/problems/kth-smallest-element-in-a-bst/", difficulty: "Medium", xp: 20 }
                ]
            },
            {
                id: "graphs",
                label: "Graphs",
                status: "unlocked",
                learningContent: {
                    title: "Graph Theory",
                    summary: "Networks of nodes and edges. Modeling complex relationships like social networks and maps.",
                    deepDive: `### Graph Representations
1. **Adjacency Matrix:** 2D array. Fast lookups \`O(1)\`, high space \`O(V^2)\`.
2. **Adjacency List:** Array of Lists. Space efficient \`O(V+E)\`.

**Core Algorithms:**
- **BFS (Breadth-First Search):** Shortest path in unweighted graphs. Uses a **Queue**.
- **DFS (Depth-First Search):** Exploring paths, cycles, mazes. Uses a **Stack** (or Recursion).

**Directed vs Undirected:**
If \`A -> B\`, can you go back? Directed = One way streets.`,
                    complexityAnalysis: {
                        access: "O(1) - Matrix, O(degree) - List.",
                        search: "O(V+E) - BFS/DFS.",
                        insertion: "O(1) - Adding edge.",
                        deletion: "O(V+E) - Removing node."
                    },
                    realWorldApplications: [
                        "Social Networks (Friends of Friends).",
                        "GPS Navigation (Shortest Path).",
                        "Dependency Resolution (npm install)."
                    ],
                    pitfalls: [
                        "Infinite loops in Cyclic Graphs (Use 'visited' set).",
                        "Disconnected components (Graph might not be fully reachable).",
                        "Selecting wrong representation (Matrix for sparse graph)."
                    ],
                    codeSnippets: {
                        python: `# BFS Implementation
def bfs(graph, start):
    visited = set()
    queue = [start]
    while queue:
        vertex = queue.pop(0)
        if vertex not in visited:
            visited.add(vertex)
            queue.extend(set(graph[vertex]) - visited)`,
                        java: `// Graph Node
class Graph {
    private int V;
    private LinkedList<Integer> adj[];
    // ...
}`,
                        cpp: `// Adjacency List
vector<vector<int>> adj;
// Add Edge
void addEdge(int u, int v) {
    adj[u].push_back(v);
}`
                    }
                },
                questions: [
                    { id: "gr_1", title: "Number of Islands", link: "https://leetcode.com/problems/number-of-islands/", difficulty: "Medium", xp: 20 },
                    { id: "gr_2", title: "Clone Graph", link: "https://leetcode.com/problems/clone-graph/", difficulty: "Medium", xp: 20 },
                    { id: "gr_3", title: "Max Area of Island", link: "https://leetcode.com/problems/max-area-of-island/", difficulty: "Medium", xp: 20 },
                    { id: "gr_4", title: "Pacific Atlantic Water Flow", link: "https://leetcode.com/problems/pacific-atlantic-water-flow/", difficulty: "Medium", xp: 20 },
                    { id: "gr_5", title: "Surrounded Regions", link: "https://leetcode.com/problems/surrounded-regions/", difficulty: "Medium", xp: 20 },
                    { id: "gr_6", title: "Rotting Oranges", link: "https://leetcode.com/problems/rotting-oranges/", difficulty: "Medium", xp: 20 },
                    { id: "gr_7", title: "Walls and Gates", link: "https://leetcode.com/problems/walls-and-gates/", difficulty: "Medium", xp: 20 },
                    { id: "gr_8", title: "Course Schedule", link: "https://leetcode.com/problems/course-schedule/", difficulty: "Medium", xp: 20 },
                    { id: "gr_9", title: "Course Schedule II", link: "https://leetcode.com/problems/course-schedule-ii/", difficulty: "Medium", xp: 20 },
                    { id: "gr_10", title: "Graph Valid Tree", link: "https://leetcode.com/problems/graph-valid-tree/", difficulty: "Medium", xp: 20 }
                ]
            }
        ];

        /* --- TOPIC DEEP DIVE COMPONENT (SLIDE-OVER) --- */
        const TopicDeepDive = ({ node, onClose, completedQuestions = [], toggleQuestion }) => {
            const { motion, AnimatePresence } = window.Motion;
            const [activeSection, setActiveSection] = useState('theory');

            // Legacy Data Adapter
            const content = useMemo(() => {
                if (!node?.learningContent) return null;
                if (node.learningContent.deepDive) return node.learningContent;
                // Adapter
                return {
                    title: node.learningContent.title || node.label,
                    summary: node.learningContent.definition,
                    deepDive: `### Key Concepts\n${node.learningContent.keyConcepts?.map(c => `- ${c}`).join('\n') || ''}\n\n### Explanation\n${node.learningContent.explanation}`,
                    complexityAnalysis: { Note: "Detailed analysis coming in v2 update." },
                    realWorldApplications: ["General Computing"],
                    pitfalls: ["Standard programming pitfalls."],
                    codeSnippets: {} // Empty to hide section
                };
            }, [node]);

            const sections = [
                { id: 'theory', label: 'Theory' },
                { id: 'complexity', label: 'Complexity' },
                { id: 'code', label: 'Polyglot Code' },
                { id: 'pitfalls', label: 'Pitfalls' },
                { id: 'practice', label: 'Practice Deck' }
            ].filter(s => {
                if (!content) return false;
                if (s.id === 'code' && (!content.codeSnippets || Object.keys(content.codeSnippets).length === 0)) return false;
                return true;
            });

            // Markdown Parser
            const renderMarkdown = (text) => {
                if (!text) return { __html: '' };
                return { __html: window.marked ? window.marked.parse(text) : text };
            };

            // Syntax Highlight Trigger
            useEffect(() => {
                if (window.Prism) window.Prism.highlightAll();
            }, [activeSection, node, content]);

            // ESCAPE KEY LISTENER
            useEffect(() => {
                const handleEsc = (e) => {
                    if (e.key === 'Escape') onClose();
                };
                window.addEventListener('keydown', handleEsc);
                return () => window.removeEventListener('keydown', handleEsc);
            }, [onClose]);

            if (!content) return null;

            const scrollTo = (id) => {
                setActiveSection(id);
                document.getElementById(`sec-${id}`)?.scrollIntoView({ behavior: 'smooth' });
            };

            return (
                <motion.div
                    initial={{ opacity: 0, scale: 0.98 }}
                    animate={{ opacity: 1, scale: 1 }}
                    exit={{ opacity: 0, scale: 0.98 }}
                    transition={{ duration: 0.2 }}
                    className="fixed inset-0 z-[100] bg-[#05050a] flex flex-col overflow-hidden"
                    onClick={(e) => { if (e.target === e.currentTarget) onClose(); }}
                >
                    {/* Header */}
                    <div className="w-full border-b border-white/5 bg-[#05050a]/90 backdrop-blur-md z-10 shrink-0">
                        <div className="max-w-screen-2xl mx-auto h-20 flex items-center justify-between px-6 lg:px-8">
                            <div className="flex items-center gap-4">
                                <div className="w-10 h-10 rounded-lg bg-brand-500/20 text-brand-400 flex items-center justify-center font-bold border border-brand-500/30">
                                    <Icon name="book-open" size={20} />
                                </div>
                                <div>
                                    <h2 className="text-xl font-bold text-white tracking-tight">{content.title}</h2>
                                    <p className="text-xs text-slate-500 font-mono uppercase tracking-widest">{node.label} MODULE</p>
                                </div>
                            </div>
                            <button
                                onClick={onClose}
                                className="group flex items-center gap-2 px-4 py-2 rounded-full bg-red-500/10 hover:bg-red-500/20 border border-red-500/20 hover:border-red-500/50 transition-all"
                            >
                                <span className="text-xs font-bold text-red-400 group-hover:text-red-300 uppercase tracking-widest hidden sm:inline-block">Close Protocol</span>
                                <div className="w-6 h-6 rounded-full bg-red-500/20 flex items-center justify-center text-red-400 group-hover:text-white">
                                    <Icon name="x" size={16} />
                                </div>
                            </button>
                        </div>
                    </div>

                    <div className="flex-1 overflow-hidden w-full max-w-screen-2xl mx-auto flex relative">
                        {/* Content Area */}
                        <div className="flex-1 overflow-y-auto custom-scrollbar p-6 md:p-12 pb-32 space-y-16 scroll-smooth">
                            {/* 1. Theory */}
                            <section id="sec-theory" className="space-y-6">
                                <div className="flex items-center gap-3 text-brand-400 border-b border-brand-500/20 pb-2 mb-6">
                                    <Icon name="book" size={20} />
                                    <h3 className="text-sm font-bold uppercase tracking-widest">Deep Theory</h3>
                                </div>
                                <p className="text-lg text-slate-300 leading-relaxed font-light">{content.summary}</p>
                                <div className="prose prose-invert prose-lg prose-p:text-slate-300 prose-headings:text-white prose-strong:text-brand-400 prose-pre:bg-[#0a0a0f] prose-pre:border prose-pre:border-white/10 prose-pre:max-w-full max-w-none break-words">
                                    <div dangerouslySetInnerHTML={renderMarkdown(content.deepDive)} />
                                </div>
                            </section>

                            {/* 2. Complexity */}
                            <section id="sec-complexity" className="space-y-6">
                                <div className="flex items-center gap-3 text-purple-400 border-b border-purple-500/20 pb-2 mb-6">
                                    <Icon name="activity" size={20} />
                                    <h3 className="text-sm font-bold uppercase tracking-widest">Complexity Analysis</h3>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {Object.entries(content.complexityAnalysis).map(([key, val]) => (
                                        <div key={key} className="bg-white/5 border border-white/5 p-4 rounded-xl flex flex-col hover:border-purple-500/30 transition-colors">
                                            <span className="text-xs text-slate-500 font-mono uppercase tracking-wider mb-2">{key}</span>
                                            <span className="text-sm font-bold text-white">{val}</span>
                                        </div>
                                    ))}
                                </div>
                            </section>

                            {/* 3. Code Implementation */}
                            {content.codeSnippets && Object.keys(content.codeSnippets).length > 0 && (
                                <section id="sec-code" className="space-y-6">
                                    <div className="flex items-center gap-3 text-emerald-400 border-b border-emerald-500/20 pb-2 mb-6">
                                        <Icon name="code" size={20} />
                                        <h3 className="text-sm font-bold uppercase tracking-widest">Polyglot Implementation</h3>
                                    </div>
                                    <div className="space-y-8">
                                        {Object.entries(content.codeSnippets).map(([lang, code]) => (
                                            <div key={lang} className="rounded-xl overflow-hidden border border-white/10 bg-[#0d0d12]">
                                                <div className="px-4 py-2 bg-white/5 border-b border-white/5 flex justify-between items-center">
                                                    <span className="text-xs font-bold text-slate-400 uppercase tracking-widest">{lang}</span>
                                                    <button className="text-xs text-brand-400 hover:text-white transition-colors" onClick={() => navigator.clipboard.writeText(code)}>COPY</button>
                                                </div>
                                                <pre className={`language-${lang} !m-0 !bg-transparent text-xs md:text-sm custom-scrollbar`}>
                                                    <code>{code}</code>
                                                </pre>
                                            </div>
                                        ))}
                                    </div>
                                </section>
                            )}

                            {/* 4. Pitfalls & Apps */}
                            <section id="sec-pitfalls" className="space-y-6">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <div>
                                        <div className="flex items-center gap-3 text-red-400 border-b border-red-500/20 pb-2 mb-6">
                                            <Icon name="alert-triangle" size={20} />
                                            <h3 className="text-sm font-bold uppercase tracking-widest">Common Pitfalls</h3>
                                        </div>
                                        <ul className="space-y-3">
                                            {content.pitfalls.map((p, i) => (
                                                <li key={i} className="flex items-start gap-3 text-sm text-slate-400">
                                                    <span className="text-red-500 mt-1"></span> {p}
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                    <div>
                                        <div className="flex items-center gap-3 text-blue-400 border-b border-blue-500/20 pb-2 mb-6">
                                            <Icon name="globe" size={20} />
                                            <h3 className="text-sm font-bold uppercase tracking-widest">Industry Use</h3>
                                        </div>
                                        <ul className="space-y-3">
                                            {content.realWorldApplications.map((app, i) => (
                                                <li key={i} className="flex items-start gap-3 text-sm text-slate-400">
                                                    <span className="text-blue-500 mt-1"></span> {app}
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                </div>
                            </section>

                            {/* 5. Practice Deck */}
                            <section id="sec-practice" className="space-y-6">
                                <div className="flex items-center gap-3 text-cyan-400 border-b border-cyan-500/20 pb-2 mb-6">
                                    <Icon name="crosshair" size={20} />
                                    <h3 className="text-sm font-bold uppercase tracking-widest">Simulation Deck</h3>
                                </div>
                                <div className="space-y-3">
                                    {node.questions.map((q) => (
                                        <div key={q.id} className={`flex items-center justify-between p-4 rounded-xl border transition-all ${completedQuestions.includes(q.id) ? 'bg-emerald-500/5 border-emerald-500/30' : 'bg-white/5 border-white/5 hover:border-purple-500/30'}`}>
                                            <div className="flex items-center gap-4">
                                                <button
                                                    onClick={() => toggleQuestion && toggleQuestion(q)}
                                                    className={`w-6 h-6 rounded border flex items-center justify-center transition-all ${completedQuestions.includes(q.id) ? 'bg-emerald-500 border-emerald-500 text-black' : 'border-slate-500 hover:border-white'}`}
                                                >
                                                    {completedQuestions.includes(q.id) && <Icon name="check" size={14} />}
                                                </button>
                                                <div className="flex flex-col">
                                                    <span className={`text-sm font-medium transition-colors ${completedQuestions.includes(q.id) ? 'text-emerald-400 line-through opacity-70' : 'text-slate-200'}`}>
                                                        {q.title}
                                                    </span>
                                                    <div className="flex gap-2 items-center mt-1">
                                                        <span className={`text-[10px] font-bold uppercase tracking-wider ${q.difficulty === 'Easy' ? 'text-emerald-500' :
                                                            q.difficulty === 'Medium' ? 'text-amber-500' : 'text-red-500'
                                                            }`}>{q.difficulty}</span>
                                                        <span className="text-[10px] text-slate-500 font-mono">+{q.xp} XP</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <a
                                                href={q.link}
                                                target="_blank"
                                                rel="noopener noreferrer"
                                                className="flex items-center gap-2 px-4 py-2 bg-transparent text-purple-400 border border-purple-500/50 font-bold text-xs rounded-lg hover:bg-purple-500 hover:text-black transition-all"
                                            >
                                                SOLVE <Icon name="external-link" size={12} />
                                            </a>
                                        </div>
                                    ))}
                                </div>
                            </section>

                            <div className="h-32 text-center flex flex-col items-center justify-center text-slate-600 space-y-4">
                                <Icon name="check-circle" size={40} className="opacity-20" />
                                <p className="text-xs uppercase tracking-[0.3em]">Module Review Complete</p>
                            </div>
                        </div>

                        {/* Sidebar TOC */}
                        <div className="hidden lg:block w-64 bg-black/20 border-l border-white/5 p-6 space-y-2 sticky top-0 shrink-0">
                            <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-6">Table of Contents</p>
                            {sections.map(s => (
                                <button
                                    key={s.id}
                                    onClick={() => scrollTo(s.id)}
                                    className={`w-full text-left px-4 py-3 rounded-lg text-xs font-bold transition-all flex items-center justify-between group ${activeSection === s.id ? 'bg-brand-500/10 text-brand-400 border border-brand-500/20' : 'text-slate-500 hover:text-white hover:bg-white/5'}`}
                                >
                                    {s.label}
                                    {activeSection === s.id && <motion.div layoutId="toc-active" className="w-1.5 h-1.5 rounded-full bg-brand-400" />}
                                </button>
                            ))}
                        </div>
                    </div>
                </motion.div>
            );
        };

        /* --- SKILL TREE COMPONENT --- */
        const SkillTree = ({ user, update, log }) => {
            const { motion, AnimatePresence } = window.Motion;
            const [selectedNode, setSelectedNode] = useState(null);

            // -------------------------------------------------------------------------
            // PHASE 1: THE DATA CORE (MASSIVE JSON)
            // -------------------------------------------------------------------------
            const legacyData = useMemo(() => [
                // --- MODULE 1: ARRAYS & STRINGS (The Foundation) ---
                {
                    id: "arrays",
                    label: "Arrays & Hashing",
                    position: { x: 150, y: 100 },
                    status: "unlocked",
                    learningContent: {
                        definition: "An array is a collection of items stored at contiguous memory locations.",
                        keyConcepts: ["0-based Indexing", "Contiguous Memory", "O(1) Access Time", "Hash Maps for O(1) Lookup"],
                        explanation: "Arrays allow random access but have expensive insertion/deletion (O(n)). Hashing maps keys to values for efficient retrieval."
                    },
                    questions: [
                        { id: "arr_1", title: "Two Sum", link: "https://leetcode.com/problems/two-sum/", difficulty: "Easy", xp: 10 },
                        { id: "arr_2", title: "Best Time to Buy and Sell Stock", link: "https://leetcode.com/problems/best-time-to-buy-and-sell-stock/", difficulty: "Easy", xp: 10 },
                        { id: "arr_3", title: "Contains Duplicate", link: "https://leetcode.com/problems/contains-duplicate/", difficulty: "Easy", xp: 10 },
                        { id: "arr_4", title: "Product of Array Except Self", link: "https://leetcode.com/problems/product-of-array-except-self/", difficulty: "Medium", xp: 20 },
                        { id: "arr_5", title: "Maximum Subarray", link: "https://leetcode.com/problems/maximum-subarray/", difficulty: "Medium", xp: 20 },
                        { id: "arr_6", title: "Maximum Product Subarray", link: "https://leetcode.com/problems/maximum-product-subarray/", difficulty: "Medium", xp: 20 },
                        { id: "arr_7", title: "Find Minimum in Rotated Sorted Array", link: "https://leetcode.com/problems/find-minimum-in-rotated-sorted-array/", difficulty: "Medium", xp: 20 },
                        { id: "arr_8", title: "Search in Rotated Sorted Array", link: "https://leetcode.com/problems/search-in-rotated-sorted-array/", difficulty: "Medium", xp: 20 },
                        { id: "arr_9", title: "3Sum", link: "https://leetcode.com/problems/3sum/", difficulty: "Medium", xp: 20 },
                        { id: "arr_10", title: "Container With Most Water", link: "https://leetcode.com/problems/container-with-most-water/", difficulty: "Medium", xp: 20 }
                    ]
                },
                {
                    id: "strings",
                    label: "String Ops",
                    position: { x: 450, y: 100 },
                    status: "unlocked",
                    learningContent: {
                        definition: "Strings are immutable sequences of characters.",
                        keyConcepts: ["Immutability", "ASCII/Unicode", "Two Pointers", "Sliding Window"],
                        explanation: "String manipulation often involves traversing the string to find patterns, substrings, or palindromes efficiently."
                    },
                    questions: [
                        { id: "str_1", title: "Valid Palindrome", link: "https://leetcode.com/problems/valid-palindrome/", difficulty: "Easy", xp: 10 },
                        { id: "str_2", title: "Valid Anagram", link: "https://leetcode.com/problems/valid-anagram/", difficulty: "Easy", xp: 10 },
                        { id: "str_3", title: "Longest Substring Without Repeating Characters", link: "https://leetcode.com/problems/longest-substring-without-repeating-characters/", difficulty: "Medium", xp: 20 },
                        { id: "str_4", title: "Longest Repeating Character Replacement", link: "https://leetcode.com/problems/longest-repeating-character-replacement/", difficulty: "Medium", xp: 20 },
                        { id: "str_5", title: "Group Anagrams", link: "https://leetcode.com/problems/group-anagrams/", difficulty: "Medium", xp: 20 },
                        { id: "str_6", title: "Valid Parentheses", link: "https://leetcode.com/problems/valid-parentheses/", difficulty: "Easy", xp: 10 },
                        { id: "str_7", title: "Longest Palindromic Substring", link: "https://leetcode.com/problems/longest-palindromic-substring/", difficulty: "Medium", xp: 20 },
                        { id: "str_8", title: "Palindromic Substrings", link: "https://leetcode.com/problems/palindromic-substrings/", difficulty: "Medium", xp: 20 },
                        { id: "str_9", title: "Encode and Decode Strings", link: "https://leetcode.com/problems/encode-and-decode-strings/", difficulty: "Medium", xp: 20 },
                        { id: "str_10", title: "Minimum Window Substring", link: "https://leetcode.com/problems/minimum-window-substring/", difficulty: "Hard", xp: 50 }
                    ]
                },

                // --- MODULE 2: LINKED LISTS & POINTERS ---
                {
                    id: "linkedlist",
                    label: "Linked Lists",
                    position: { x: 300, y: 300 },
                    dependencies: ["arrays"],
                    learningContent: {
                        definition: "A linear data structure where elements are not stored in contiguous locations.",
                        keyConcepts: ["Nodes & Pointers", "Singly vs Doubly Linked", "Fast & Slow Pointers", "Cycle Detection"],
                        explanation: "Linked Lists allow dynamic memory allocation and efficient insertion/deletion but have slow random access (O(n))."
                    },
                    questions: [
                        { id: "ll_1", title: "Reverse Linked List", link: "https://leetcode.com/problems/reverse-linked-list/", difficulty: "Easy", xp: 10 },
                        { id: "ll_2", title: "Merge Two Sorted Lists", link: "https://leetcode.com/problems/merge-two-sorted-lists/", difficulty: "Easy", xp: 10 },
                        { id: "ll_3", title: "Reorder List", link: "https://leetcode.com/problems/reorder-list/", difficulty: "Medium", xp: 20 },
                        { id: "ll_4", title: "Remove Nth Node From End of List", link: "https://leetcode.com/problems/remove-nth-node-from-end-of-list/", difficulty: "Medium", xp: 20 },
                        { id: "ll_5", title: "Copy List with Random Pointer", link: "https://leetcode.com/problems/copy-list-with-random-pointer/", difficulty: "Medium", xp: 20 },
                        { id: "ll_6", title: "Add Two Numbers", link: "https://leetcode.com/problems/add-two-numbers/", difficulty: "Medium", xp: 20 },
                        { id: "ll_7", title: "Linked List Cycle", link: "https://leetcode.com/problems/linked-list-cycle/", difficulty: "Easy", xp: 10 },
                        { id: "ll_8", title: "Find the Duplicate Number", link: "https://leetcode.com/problems/find-the-duplicate-number/", difficulty: "Medium", xp: 20 },
                        { id: "ll_9", title: "LRU Cache", link: "https://leetcode.com/problems/lru-cache/", difficulty: "Medium", xp: 20 },
                        { id: "ll_10", title: "Merge K Sorted Lists", link: "https://leetcode.com/problems/merge-k-sorted-lists/", difficulty: "Hard", xp: 50 }
                    ]
                },

                // --- MODULE 3: TREES & GRAPHS ---
                {
                    id: "trees",
                    label: "Trees & BST",
                    position: { x: 150, y: 500 },
                    dependencies: ["linkedlist"],
                    learningContent: {
                        definition: "A hierarchical data structure consisting of nodes with parent-child relationships.",
                        keyConcepts: ["Root & Leaves", "Binary Search Trees (BST)", "DFS vs BFS", "Recursion"],
                        explanation: "Trees are used for hierarchical data (like file systems). BSTs enable fast search, insertion, and deletion (O(log n))."
                    },
                    questions: [
                        { id: "tr_1", title: "Invert Binary Tree", link: "https://leetcode.com/problems/invert-binary-tree/", difficulty: "Easy", xp: 10 },
                        { id: "tr_2", title: "Maximum Depth of Binary Tree", link: "https://leetcode.com/problems/maximum-depth-of-binary-tree/", difficulty: "Easy", xp: 10 },
                        { id: "tr_3", title: "Diameter of Binary Tree", link: "https://leetcode.com/problems/diameter-of-binary-tree/", difficulty: "Easy", xp: 10 },
                        { id: "tr_4", title: "Balanced Binary Tree", link: "https://leetcode.com/problems/balanced-binary-tree/", difficulty: "Easy", xp: 10 },
                        { id: "tr_5", title: "Same Tree", link: "https://leetcode.com/problems/same-tree/", difficulty: "Easy", xp: 10 },
                        { id: "tr_6", title: "Subtree of Another Tree", link: "https://leetcode.com/problems/subtree-of-another-tree/", difficulty: "Easy", xp: 10 },
                        { id: "tr_7", title: "Lowest Common Ancestor of a BST", link: "https://leetcode.com/problems/lowest-common-ancestor-of-a-binary-search-tree/", difficulty: "Medium", xp: 20 },
                        { id: "tr_8", title: "Binary Tree Level Order Traversal", link: "https://leetcode.com/problems/binary-tree-level-order-traversal/", difficulty: "Medium", xp: 20 },
                        { id: "tr_9", title: "Validate Binary Search Tree", link: "https://leetcode.com/problems/validate-binary-search-tree/", difficulty: "Medium", xp: 20 },
                        { id: "tr_10", title: "Kth Smallest Element in a BST", link: "https://leetcode.com/problems/kth-smallest-element-in-a-bst/", difficulty: "Medium", xp: 20 }
                    ]
                },
                {
                    id: "graphs",
                    label: "Graphs",
                    position: { x: 450, y: 500 },
                    dependencies: ["trees"],
                    learningContent: {
                        definition: "A collection of nodes (vertices) and edges connecting them.",
                        keyConcepts: ["Adjacency Matrix/List", "Directed vs Undirected", "Topological Sort", "Shortest Path (Dijkstra)"],
                        explanation: "Graphs model networks. Traversals like BFS (shortest path) and DFS (path existence) are fundamental algorithms."
                    },
                    questions: [
                        { id: "gr_1", title: "Number of Islands", link: "https://leetcode.com/problems/number-of-islands/", difficulty: "Medium", xp: 20 },
                        { id: "gr_2", title: "Clone Graph", link: "https://leetcode.com/problems/clone-graph/", difficulty: "Medium", xp: 20 },
                        { id: "gr_3", title: "Max Area of Island", link: "https://leetcode.com/problems/max-area-of-island/", difficulty: "Medium", xp: 20 },
                        { id: "gr_4", title: "Pacific Atlantic Water Flow", link: "https://leetcode.com/problems/pacific-atlantic-water-flow/", difficulty: "Medium", xp: 20 },
                        { id: "gr_5", title: "Surrounded Regions", link: "https://leetcode.com/problems/surrounded-regions/", difficulty: "Medium", xp: 20 },
                        { id: "gr_6", title: "Rotting Oranges", link: "https://leetcode.com/problems/rotting-oranges/", difficulty: "Medium", xp: 20 },
                        { id: "gr_7", title: "Walls and Gates", link: "https://leetcode.com/problems/walls-and-gates/", difficulty: "Medium", xp: 20 },
                        { id: "gr_8", title: "Course Schedule", link: "https://leetcode.com/problems/course-schedule/", difficulty: "Medium", xp: 20 },
                        { id: "gr_9", title: "Course Schedule II", link: "https://leetcode.com/problems/course-schedule-ii/", difficulty: "Medium", xp: 20 },
                        { id: "gr_10", title: "Graph Valid Tree", link: "https://leetcode.com/problems/graph-valid-tree/", difficulty: "Medium", xp: 20 }
                    ]
                },

                // --- MODULE 4: ADVANCED ALGORITHMS ---
                {
                    id: "dp",
                    label: "Dynamic Programming",
                    position: { x: 300, y: 700 },
                    dependencies: ["trees"],
                    learningContent: {
                        definition: "An optimization technique that solves problems by breaking them into overlapping subproblems.",
                        keyConcepts: ["Memoization (Top-Down)", "Tabulation (Bottom-Up)", "State Transition", "Optimal Substructure"],
                        explanation: "DP is used when a problem has overlapping subproblems. We store results of subproblems to avoid redundant re-computation."
                    },
                    questions: [
                        { id: "dp_1", title: "Climbing Stairs", link: "https://leetcode.com/problems/climbing-stairs/", difficulty: "Easy", xp: 10 },
                        { id: "dp_2", title: "Min Cost Climbing Stairs", link: "https://leetcode.com/problems/min-cost-climbing-stairs/", difficulty: "Easy", xp: 10 },
                        { id: "dp_3", title: "House Robber", link: "https://leetcode.com/problems/house-robber/", difficulty: "Medium", xp: 20 },
                        { id: "dp_4", title: "House Robber II", link: "https://leetcode.com/problems/house-robber-ii/", difficulty: "Medium", xp: 20 },
                        { id: "dp_5", title: "Longest Palindromic Substring", link: "https://leetcode.com/problems/longest-palindromic-substring/", difficulty: "Medium", xp: 20 },
                        { id: "dp_6", title: "Palindromic Substrings", link: "https://leetcode.com/problems/palindromic-substrings/", difficulty: "Medium", xp: 20 },
                        { id: "dp_7", title: "Decode Ways", link: "https://leetcode.com/problems/decode-ways/", difficulty: "Medium", xp: 20 },
                        { id: "dp_8", title: "Coin Change", link: "https://leetcode.com/problems/coin-change/", difficulty: "Medium", xp: 20 },
                        { id: "dp_9", title: "Maximum Product Subarray", link: "https://leetcode.com/problems/maximum-product-subarray/", difficulty: "Medium", xp: 20 },
                        { id: "dp_10", title: "Word Break", link: "https://leetcode.com/problems/word-break/", difficulty: "Medium", xp: 20 }
                    ]
                },
                {
                    id: "heaps",
                    label: "Heaps & PQ",
                    position: { x: 150, y: 900 },
                    dependencies: ["trees"],
                    learningContent: {
                        definition: "A specialized tree-based data structure that satisfies the heap property.",
                        keyConcepts: ["Min-Heap vs Max-Heap", "Priority Queue", "Heapify", "O(log n) Insert/Extract"],
                        explanation: "Heaps allows fast access to the max or min element. Useful for priority queues, scheduling, and finding 'K-th largest' elements."
                    },
                    questions: [
                        { id: "h_1", title: "Kth Largest Element in a Stream", link: "https://leetcode.com/problems/kth-largest-element-in-a-stream/", difficulty: "Easy", xp: 10 },
                        { id: "h_2", title: "Last Stone Weight", link: "https://leetcode.com/problems/last-stone-weight/", difficulty: "Easy", xp: 10 },
                        { id: "h_3", title: "K Closest Points to Origin", link: "https://leetcode.com/problems/k-closest-points-to-origin/", difficulty: "Medium", xp: 20 },
                        { id: "h_4", title: "Kth Largest Element in an Array", link: "https://leetcode.com/problems/kth-largest-element-in-an-array/", difficulty: "Medium", xp: 20 },
                        { id: "h_5", title: "Task Scheduler", link: "https://leetcode.com/problems/task-scheduler/", difficulty: "Medium", xp: 20 },
                        { id: "h_6", title: "Design Twitter", link: "https://leetcode.com/problems/design-twitter/", difficulty: "Medium", xp: 20 },
                        { id: "h_7", title: "Find Median from Data Stream", link: "https://leetcode.com/problems/find-median-from-data-stream/", difficulty: "Hard", xp: 50 },
                        { id: "h_8", title: "Merge K Sorted Lists", link: "https://leetcode.com/problems/merge-k-sorted-lists/", difficulty: "Hard", xp: 50 },
                        { id: "h_9", title: "IPO", link: "https://leetcode.com/problems/ipo/", difficulty: "Hard", xp: 50 },
                        { id: "h_10", title: "Find K Pairs with Smallest Sums", link: "https://leetcode.com/problems/find-k-pairs-with-smallest-sums/", difficulty: "Medium", xp: 20 }
                    ]
                },
                {
                    id: "greedy",
                    label: "Greedy",
                    position: { x: 450, y: 900 },
                    dependencies: ["arrays"],
                    learningContent: {
                        definition: "An algorithmic paradigm that builds a solution piece by piece.",
                        keyConcepts: ["Local Optimal Choice", "Global Optimum", "Interval Problems", "Proof of Correctness"],
                        explanation: "Greedy algorithms make the locally optimal choice at each step. Efficient but doesn't always guarantee the global best (unlike DP)."
                    },
                    questions: [
                        { id: "gd_1", title: "Maximum Subarray", link: "https://leetcode.com/problems/maximum-subarray/", difficulty: "Easy", xp: 10 },
                        { id: "gd_2", title: "Jump Game", link: "https://leetcode.com/problems/jump-game/", difficulty: "Medium", xp: 20 },
                        { id: "gd_3", title: "Jump Game II", link: "https://leetcode.com/problems/jump-game-ii/", difficulty: "Medium", xp: 20 },
                        { id: "gd_4", title: "Gas Station", link: "https://leetcode.com/problems/gas-station/", difficulty: "Medium", xp: 20 },
                        { id: "gd_5", title: "Hand of Straights", link: "https://leetcode.com/problems/hand-of-straights/", difficulty: "Medium", xp: 20 },
                        { id: "gd_6", title: "Merge Triplets to Form Target Triplet", link: "https://leetcode.com/problems/merge-triplets-to-form-target-triplet/", difficulty: "Medium", xp: 20 },
                        { id: "gd_7", title: "Partition Labels", link: "https://leetcode.com/problems/partition-labels/", difficulty: "Medium", xp: 20 },
                        { id: "gd_8", title: "Valid Parenthesis String", link: "https://leetcode.com/problems/valid-parenthesis-string/", difficulty: "Medium", xp: 20 },
                        { id: "gd_9", title: "Reconstruct Queue by Height", link: "https://leetcode.com/problems/reconstruct-queue-by-height/", difficulty: "Medium", xp: 20 },
                        { id: "gd_10", title: "Non-overlapping Intervals", link: "https://leetcode.com/problems/non-overlapping-intervals/", difficulty: "Medium", xp: 20 }
                    ]
                }
            ], []);

            // Merge Legacy with Deep Dive Data
            const dsaMasterData = useMemo(() => {
                const legacy = legacyData;
                // Overlay Global Data
                const merged = legacy.map(node => {
                    const upgrade = DSA_MASTER_DATA.find(n => n.id === node.id);
                    return upgrade ? { ...node, ...upgrade } : node;
                });
                // Add new Global Data (Recursion) - ENSURE IT HAS POSITION
                const attempts = DSA_MASTER_DATA
                    .filter(n => !legacy.find(l => l.id === n.id))
                    .map(n => ({
                        ...n,
                        position: n.position || { x: 50, y: 50 }, // Fallback to avoid crash
                        learningContent: n.learningContent || {}
                    }));

                return [...merged, ...attempts];
            }, [legacyData]);

            // -------------------------------------------------------------------------
            // PHASE 2: GAMIFICATION & LOGIC
            // -------------------------------------------------------------------------

            // -------------------------------------------------------------------------
            // PHASE 2: GAMIFICATION & LOGIC
            // -------------------------------------------------------------------------

            // State: Modes, Progress, & Visuals
            const [dsaMode, setDsaMode] = useState(user.dsaMode || 'learning'); // 'learning' | 'practice'
            const [completedQuestions, setCompletedQuestions] = useState(user.solvedQuestions || []);
            const [totalXP, setTotalXP] = useState(user.totalXP || 0);
            const [shakingNode, setShakingNode] = useState(null);
            const [modalTab, setModalTab] = useState('theory'); // 'theory' | 'practice'

            // Sync with User Object
            useEffect(() => {
                if (
                    JSON.stringify(user.solvedQuestions) !== JSON.stringify(completedQuestions) ||
                    user.totalXP !== totalXP ||
                    user.dsaMode !== dsaMode
                ) {
                    update({ ...user, solvedQuestions: completedQuestions, totalXP: totalXP, dsaMode: dsaMode });
                }
            }, [completedQuestions, totalXP, dsaMode]);

            // Calculate Node Statuses dynamically
            const nodes = useMemo(() => {
                return dsaMasterData.map(node => {
                    // PRACTICE MODE: EVERYTHING UNLOCKED
                    if (dsaMode === 'practice') {
                        const mySolved = node.questions.filter(q => completedQuestions.includes(q.id)).length;
                        return { ...node, status: mySolved === node.questions.length && node.questions.length > 0 ? 'mastered' : 'unlocked' };
                    }

                    // LEARNING MODE: STRICT LOCKING
                    let isLocked = false;
                    if (node.dependencies) {
                        node.dependencies.forEach(depId => {
                            const depNode = dsaMasterData.find(d => d.id === depId);
                            if (depNode) {
                                // Count solved in depNode
                                const solvedCount = depNode.questions.filter(q => completedQuestions.includes(q.id)).length;
                                if (solvedCount < 5) isLocked = true; // REQUIRE 5 QUESTIONS TO UNLOCK NEXT
                            }
                        });
                    }

                    // Override: Root nodes always unlocked
                    if (node.status === "unlocked") isLocked = false;

                    // Check Mastery
                    const mySolved = node.questions.filter(q => completedQuestions.includes(q.id)).length;
                    let status = isLocked ? 'locked' : 'unlocked';
                    if (mySolved === node.questions.length && node.questions.length > 0) status = 'mastered';

                    return { ...node, status };
                });
            }, [dsaMasterData, completedQuestions, dsaMode]);

            // Helper to get connection lines
            const lines = useMemo(() => {
                const l = [];
                nodes.forEach(n => {
                    (n.dependencies || []).forEach(dId => {
                        const parent = nodes.find(x => x.id === dId);
                        if (parent) l.push({ from: parent.position, to: n.position, id: `${parent.id}-${n.id}`, status: n.status });
                    });
                });
                return l;
            }, [nodes]);

            const handleNodeClick = (node) => {
                if (node.status === 'locked') {
                    setShakingNode(node.id);
                    setTimeout(() => setShakingNode(null), 500);
                    return;
                }
                setModalTab(dsaMode === 'learning' ? 'theory' : 'practice');
                setSelectedNode(node);
            };

            const toggleQuestion = (q) => {
                const isSolved = completedQuestions.includes(q.id);
                if (isSolved) {
                    setCompletedQuestions(prev => prev.filter(id => id !== q.id));
                    setTotalXP(prev => Math.max(0, prev - q.xp));
                } else {
                    setCompletedQuestions(prev => [...prev, q.id]);
                    setTotalXP(prev => prev + q.xp);
                }
            };



            // Global Stats
            const totalQuestions = dsaMasterData.reduce((acc, n) => acc + n.questions.length, 0);
            const totalSolved = completedQuestions.length;
            const progressPercent = Math.min(100, (totalSolved / totalQuestions) * 100);

            const getRank = () => {
                if (progressPercent >= 90) return "Grandmaster";
                if (progressPercent >= 60) return "Master";
                if (progressPercent >= 30) return "Adept";
                if (progressPercent >= 10) return "Apprentice";
                return "Novice";
            };

            return (
                <div className="relative w-full h-[800px] bg-[#080910] rounded-3xl border border-white/10 overflow-hidden shadow-2xl group flex flex-col font-sans">
                    {/* OVERLAY: MODE TOGGLE (LEFT) */}
                    <div className="absolute top-4 left-4 z-20 flex flex-col gap-2">
                        <div className="flex bg-black/60 backdrop-blur-md p-1 rounded-xl border border-white/10">
                            <button
                                onClick={() => setDsaMode('learning')}
                                className={`px-4 py-2 rounded-lg text-xs font-bold uppercase tracking-wider flex items-center gap-2 transition-all ${dsaMode === 'learning' ? 'bg-cyan-500/20 text-cyan-400 border border-cyan-500/50 shadow-[0_0_15px_rgba(34,211,238,0.3)]' : 'text-slate-500 hover:text-white'}`}
                            >
                                <Icon name="book-open" size={14} /> Learning
                            </button>
                            <button
                                onClick={() => setDsaMode('practice')}
                                className={`px-4 py-2 rounded-lg text-xs font-bold uppercase tracking-wider flex items-center gap-2 transition-all ${dsaMode === 'practice' ? 'bg-purple-500/20 text-purple-400 border border-purple-500/50 shadow-[0_0_15px_rgba(168,85,247,0.3)]' : 'text-slate-500 hover:text-white'}`}
                            >
                                <Icon name="crosshair" size={14} /> Practice
                            </button>
                        </div>
                        <div className="bg-black/40 backdrop-blur px-3 py-1 rounded-lg border border-white/5 text-[10px] text-slate-400 font-mono">
                            {dsaMode === 'learning' ? ' Strict progression enabled.' : ' Sandbox access unlocked.'}
                        </div>
                    </div>

                    {/* OVERLAY: MASTERY BAR (RIGHT) */}
                    <div className="absolute top-4 right-4 z-20 w-64 bg-black/80 backdrop-blur-md p-4 rounded-xl border border-white/10 shadow-2xl flex flex-col gap-3">
                        <div className="flex justify-between items-end">
                            <div className="flex flex-col">
                                <span className="text-[10px] font-bold uppercase tracking-widest text-slate-500">Current Rank</span>
                                <span className="text-xl font-black text-white">{getRank()}</span>
                            </div>
                            <div className="text-right">
                                <span className="text-2xl font-mono font-bold text-cyan-400">{completedQuestions.length}</span>
                                <span className="text-xs text-slate-500">/{totalQuestions} Solved</span>
                            </div>
                        </div>
                        <div className="w-full h-2 bg-white/10 rounded-full overflow-hidden relative">
                            <div className="absolute inset-0 bg-gradient-to-r from-cyan-500 to-purple-500 transition-all duration-1000" style={{ width: `${progressPercent}%` }}></div>
                        </div>
                        <div className="flex justify-between text-[10px] font-mono text-slate-500">
                            <span>{Math.round(progressPercent)}% COMPLETE</span>
                            <span>{totalXP} XP</span>
                        </div>
                    </div>

                    {/* SCROLLABLE CANVAS CONTAINER */}
                    <div className="overflow-auto w-full h-full cursor-grab active:cursor-grabbing relative scrollbar-hide">
                        <div className="relative w-[1500px] h-[1500px]">
                            {/* Background Grid */}
                            <div className="absolute inset-0 opacity-20 pointer-events-none"
                                style={{ backgroundImage: 'radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px)', backgroundSize: '30px 30px' }}>
                            </div>

                            {/* SVG Connections */}
                            <svg className="absolute inset-0 w-full h-full pointer-events-none z-0">
                                {lines.map(line => (
                                    <motion.line
                                        key={line.id}
                                        x1={line.from.x + 56} y1={line.from.y + 56}
                                        x2={line.to.x + 56} y2={line.to.y + 56}
                                        stroke={line.status === 'locked' ? '#334155' : dsaMode === 'practice' ? '#a855f7' : '#22d3ee'}
                                        strokeWidth="2"
                                        strokeDasharray={line.status === 'locked' ? "5,5" : "0"}
                                        initial={{ pathLength: 0, opacity: 0 }}
                                        animate={{ pathLength: 1, opacity: 1 }}
                                        transition={{ duration: 1.5, ease: "easeInOut" }}
                                    />
                                ))}
                            </svg>

                            {/* Nodes */}
                            <div className="relative z-10 w-full h-full">
                                {nodes.map(node => (
                                    <motion.div
                                        key={node.id}
                                        className={`absolute w-28 h-28 rounded-full flex flex-col items-center justify-center text-center p-2 border-2 cursor-pointer transition-all duration-300 backdrop-blur-md shadow-[0_0_30px_rgba(0,0,0,0.5)] z-10
                                            ${node.status === 'mastered' ? 'bg-emerald-500/20 border-emerald-500 text-white shadow-[0_0_20px_rgba(16,185,129,0.4)]' :
                                                node.status === 'unlocked' ? (dsaMode === 'practice' ? 'bg-purple-500/10 border-purple-400 text-purple-300 shadow-[0_0_15px_rgba(168,85,247,0.3)]' : 'bg-cyan-500/10 border-cyan-400 text-cyan-300 shadow-[0_0_15px_rgba(34,211,238,0.3)]') :
                                                    'bg-slate-800/50 border-slate-700 text-slate-600 grayscale brightness-50'}`}
                                        style={{ left: node.position.x, top: node.position.y }}
                                        onClick={() => handleNodeClick(node)}
                                        animate={shakingNode === node.id ? { x: [0, -5, 5, -5, 5, 0] } : {}}
                                        whileHover={node.status !== 'locked' ? { scale: 1.15, zIndex: 50 } : {}}
                                        whileTap={node.status !== 'locked' ? { scale: 0.95 } : {}}
                                    >
                                        <Icon name={node.status === 'locked' ? "lock" : node.status === 'mastered' ? "check-circle" : dsaMode === 'practice' ? "crosshair" : "book"}
                                            size={20}
                                            className={`mb-1 ${node.status === 'mastered' ? 'text-emerald-400' : node.status === 'unlocked' ? (dsaMode === 'practice' ? 'text-purple-400' : 'text-cyan-400') : 'text-slate-600'}`}
                                        />
                                        <span className="text-[10px] font-bold uppercase tracking-wider leading-tight line-clamp-2">{node.label}</span>
                                        {node.status !== 'locked' && (
                                            <div className="mt-1 text-[8px] font-mono text-slate-400">
                                                {node.questions.filter(q => completedQuestions.includes(q.id)).length}/{node.questions.length}
                                            </div>
                                        )}

                                        {/* Locked Tooltip */}
                                        {node.status === 'locked' && shakingNode === node.id && (
                                            <div className="absolute top-full mt-2 bg-red-500/90 text-white text-[10px] px-2 py-1 rounded w-32 font-bold animate-bounce z-50 pointer-events-none">
                                                LOCKED: Complete dependencies first!
                                            </div>
                                        )}
                                    </motion.div>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* TOPIC DEEP DIVE (NEW UI) */}
                    <AnimatePresence>
                        {selectedNode && (
                            <TopicDeepDive
                                node={selectedNode}
                                onClose={() => setSelectedNode(null)}
                                completedQuestions={completedQuestions}
                                toggleQuestion={toggleQuestion}
                            />
                        )}
                    </AnimatePresence>
                </div>
            );
        };



        /* --- DSA TRACKER COMPONENT --- */
        const DSATracker = ({ user, update, log }) => {
            // Keeping the original dsaData structure logic for compatibility with other parts
            const dsaData = (user.dsa && user.dsa.length) ? user.dsa : [];
            const combinedTotal = 450; // Mock total
            const combinedSolved = 12; // Mock solved

            return (
                <div className="space-y-8 animate-fade-in pb-12">
                    <div className="flex flex-col md:flex-row justify-between items-end gap-6 mb-8 border-b border-white/5 pb-6">
                        <div>
                            <h2 className="text-4xl font-bold text-white tracking-tight">DSA Hypergraph</h2>
                            <p className="text-slate-400 mt-2 font-mono text-xs">NEURAL SKILL TREE // VISUALIZATION MODE</p>
                        </div>
                        <div className="w-full md:w-64">
                            <div className="flex justify-between text-xs font-bold uppercase tracking-widest mb-2 text-slate-400">
                                <span>Mastery Level</span>
                                <span className="text-brand-400">{combinedSolved} XP</span>
                            </div>
                            <ProgressBar value={combinedSolved} max={100} color="bg-cyan-500" />
                        </div>
                    </div>

                    <SkillTree user={user} update={update} log={log} />
                </div>
            )
        };

        const HRPrep = ({ user, update, log }) => {
            const hrQuestions = [
                // --- SECTION 1: INTRODUCTION & SELF ---
                { id: 1, q: "Tell me about yourself.", tip: "Use the 'Present-Past-Future' formula. Start with current role, mention past relevant experience, and end with why you want this specific role." },
                { id: 2, q: "What are your greatest strengths?", tip: "Don't just list adjectives. Pick 1-2 strengths (e.g., adaptability, problem-solving) and provide a concrete example/story." },
                { id: 3, q: "What is your biggest weakness?", tip: "Choose a real weakness (not 'I work too hard'). Crucially, mention the steps you are actively taking to improve it." },
                { id: 4, q: "Describe yourself in three words.", tip: "Select words that align with the company culture (e.g., 'Curious, Resilient, Collaborative')." },
                { id: 5, q: "What are your hobbies?", tip: "Keep it professional but authentic. It shows personality. Avoid controversial topics." },

                // --- SECTION 2: COMPANY & ROLE ---
                { id: 6, q: "Why do you want to work here?", tip: "Do not mention salary. Mention their specific products, culture, or recent news that excites you." },
                { id: 7, q: "What do you know about our company?", tip: "Mention their CEO, main products, competitors, and recent achievements. Show you did your homework." },
                { id: 8, q: "Why should we hire you?", tip: "Match your skills directly to the Job Description. 'You need X, and I have done X in my project Y...'" },
                { id: 9, q: "Where do you see yourself in 5 years?", tip: "Show ambition but commitment. 'I hope to have grown into a senior technical role within this team...'" },
                { id: 10, q: "Are you willing to relocate?", tip: "Be honest. If yes, say 'Absolutely'. If no, explain valid reasons or preference for remote work." },

                // --- SECTION 3: BEHAVIORAL (STAR METHOD) ---
                { id: 11, q: "Tell me about a time you faced a challenge.", tip: "Use STAR (Situation, Task, Action, Result). Focus heavily on the 'Action' YOU took." },
                { id: 12, q: "How do you handle pressure or deadlines?", tip: "Give an example of prioritizing tasks or using tools (like Trello/Velosify) to manage stress." },
                { id: 13, q: "Describe a time you had a conflict with a team member.", tip: "Focus on resolution, not the fight. Show you can listen and compromise for the team's goal." },
                { id: 14, q: "Tell me about a time you failed.", tip: "Admit the mistake clearly. Focus on what you learned and how you prevented it from happening again." },
                { id: 15, q: "Give an example of when you showed leadership.", tip: "Leadership isn't just management. It can be taking initiative on a project or mentoring a junior." },

                // --- SECTION 4: SITUATIONAL & TRICKY ---
                { id: 16, q: "What is your salary expectation?", tip: "Offer a range based on market research. 'Based on market standards for freshers, I expect between X and Y...'" },
                { id: 17, q: "Do you have any offers in hand?", tip: "You can say yes (it increases value) but don't be arrogant. 'I am in talks with a few others, but this is my top choice.'" },
                { id: 18, q: "Why is there a gap in your resume?", tip: "Be honest. Mention upskilling, courses, or personal growth during that time. Never say 'I did nothing'." },
                { id: 19, q: "How do you handle criticism?", tip: "State that you view feedback as a tool for growth, not a personal attack." },
                { id: 20, q: "Are you a team player or a lone wolf?", tip: "Most companies want team players. Say you enjoy collaboration but can also work independently when needed." },

                // --- SECTION 5: TECHNICAL/WORK STYLE ---
                { id: 21, q: "What is your preferred programming language and why?", tip: "Choose one you are strongest in. Mention libraries, community support, or specific features (e.g., Java's OOP)." },
                { id: 22, q: "How do you keep yourself updated with technology?", tip: "Mention blogs (Medium), news sites (TechCrunch), or YouTube channels you follow." },
                { id: 23, q: "Describe a project you are proud of.", tip: "Discuss the problem it solved, the tech stack used, and your specific contribution." },
                { id: 24, q: "How do you approach a problem you don't know the answer to?", tip: "Show resourcefulness. 'I research documentation, ask peers, or break the problem down...'" },
                { id: 25, q: "What software tools do you use daily?", tip: "Mention IDEs (VS Code), Version Control (Git), and Project Management tools." },

                // --- SECTION 6: CLOSING ---
                { id: 26, q: "Do you have any questions for us?", tip: "ALWAYS ask something. 'What does a typical day look like?' or 'What tech stack is the team using?'" },
                { id: 27, q: "What motivates you?", tip: "Solving complex problems, learning new things, or seeing the impact of your work." },
                { id: 28, q: "Are you willing to work in shifts?", tip: "If the company requires it (like TCS/Infosys), say yes. Flexibility is key for freshers." },
                { id: 29, q: "What is your dream job?", tip: "Keep it related to the field. 'A role where I can architect scalable systems...'" },
                { id: 30, q: "If you were an animal, which one would you be?", tip: "Pick one with positive traits. 'An ant (hardworking/team player)' or 'Eagle (focused/visionary)'." }
            ];

            const [expanded, setExpanded] = useState(null);

            const handleAnswerChange = (id, val) => {
                const currentAnswers = user.hrAnswers || {};
                update({ ...user, hrAnswers: { ...currentAnswers, [id]: val } });
            };

            return (
                <div className="space-y-8 animate-fade-in pb-12 max-w-4xl mx-auto">
                    <div className="flex justify-between items-end border-b border-white/5 pb-6">
                        <div>
                            <h2 className="text-4xl font-bold text-white tracking-tight">HR Protocol</h2>
                            <p className="text-slate-400 mt-2 font-mono text-xs">BEHAVIORAL INTERVIEW PREPARATION</p>
                        </div>
                    </div>

                    <div className="space-y-4">
                        {hrQuestions.map(q => (
                            <div key={q.id} className="holo-card p-0 rounded-xl overflow-hidden group">
                                <button
                                    onClick={() => setExpanded(expanded === q.id ? null : q.id)}
                                    className="w-full text-left p-6 flex justify-between items-center hover:bg-white/5 transition-colors"
                                >
                                    <div className="flex items-center gap-4">
                                        <div className="w-8 h-8 rounded-lg bg-pink-500/10 text-pink-400 flex items-center justify-center font-bold border border-pink-500/20">{q.id}</div>
                                        <h3 className="font-bold text-lg text-slate-200 group-hover:text-white transition-colors">{q.q}</h3>
                                    </div>
                                    <Icon name={expanded === q.id ? "chevron-up" : "chevron-down"} className="text-slate-500" />
                                </button>

                                {expanded === q.id && (
                                    <div className="p-6 pt-0 bg-black/20 border-t border-white/5 animate-fade-in">
                                        <div className="mb-6 mt-4 p-4 rounded-lg bg-brand-500/10 border border-brand-500/20 text-sm text-brand-300 flex items-start gap-3">
                                            <Icon name="lightbulb" size={16} className="mt-0.5 shrink-0" />
                                            <div>
                                                <span className="font-bold uppercase tracking-wider text-[10px] block mb-1">Pro Tip</span>
                                                {q.tip}
                                            </div>
                                        </div>

                                        <div className="space-y-2">
                                            <label className="text-[10px] font-bold uppercase tracking-widest text-slate-500">Your Response Strategy</label>
                                            <textarea
                                                value={(user.hrAnswers && user.hrAnswers[q.id]) || ""}
                                                onChange={(e) => handleAnswerChange(q.id, e.target.value)}
                                                placeholder="Draft your STAR method answer here..."
                                                className="w-full h-32 bg-black/40 border border-white/10 rounded-xl p-4 text-slate-300 focus:border-pink-500 focus:ring-1 focus:ring-pink-500 outline-none transition-all font-mono text-sm resize-none"
                                            />
                                        </div>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            )
        };

        const Settings = ({ user, update, reset }) => {
            const themes = { violet: 'Violet', cyan: 'Cyber', emerald: 'Matrix', rose: 'Neon' };
            return (
                <div className="max-w-xl mx-auto space-y-8 animate-fade-in">
                    <h2 className="text-3xl font-bold text-white">System Configuration</h2>
                    <Card className="space-y-6">
                        <div><label className="text-xs text-brand-400 font-bold uppercase tracking-widest block mb-4">Interface Theme</label><div className="flex gap-4">{Object.entries(themes).map(([k, n]) => <button key={k} onClick={() => update({ ...user, themeColor: k })} className={`flex-1 py-3 rounded-xl border font-bold text-xs uppercase transition-all ${user.themeColor === k ? 'border-brand-500 bg-brand-500/20 text-white shadow-[0_0_15px_rgba(var(--brand-500),0.3)]' : 'border-white/10 text-slate-500 hover:bg-white/5'}`}>{n}</button>)}</div></div>
                        <div><label className="text-xs text-brand-400 font-bold uppercase tracking-widest block mb-2">Primary Objective</label><input value={user.goalName || ''} onChange={e => update({ ...user, goalName: e.target.value })} className="w-full bg-black/50 border border-white/10 p-3 rounded-xl text-white outline-none focus:border-brand-500" /></div>
                        <div><label className="text-xs text-brand-400 font-bold uppercase tracking-widest block mb-2">Target Date</label><input type="date" value={user.examDate || ''} onChange={e => update({ ...user, examDate: e.target.value })} className="w-full bg-black/50 border border-white/10 p-3 rounded-xl text-white outline-none focus:border-brand-500" /></div>
                    </Card>
                    <div className="border border-red-500/30 bg-red-900/10 rounded-xl p-6 flex justify-between items-center"><div className="text-red-300 font-bold flex gap-2 items-center"><Icon name="alert-triangle" /> DANGER ZONE</div><button onClick={reset} className="px-4 py-2 bg-red-600/20 text-red-400 border border-red-500/50 rounded-lg hover:bg-red-600 hover:text-white transition-all font-bold text-xs uppercase">Factory Reset</button></div>
                </div>
            )
        };

        /* --- ROADMAP ENGINE (NEW MODULE) --- */
        const ROADMAP_MASTER_DATA = {
            frontend: {
                id: "frontend",
                title: "Frontend Developer",
                description: "Master the art of creating beautiful user interfaces.",
                nodes: [
                    { id: "internet", label: "Internet & Web", type: "root", status: "unlocked", desc: "How the web works (DNS, HTTP, Browsers)." },
                    { id: "html", label: "HTML", type: "main", parent: "internet", desc: "The skeleton of all web pages.", resources: [{ title: "MDN HTML", link: "https://developer.mozilla.org/en-US/docs/Web/HTML" }] },
                    { id: "css", label: "CSS", type: "main", parent: "html", desc: "Styling and layout fundamentals.", resources: [{ title: "CSS Tricks", link: "https://css-tricks.com" }] },
                    { id: "js", label: "JavaScript", type: "main", parent: "css", desc: "The language of the web.", resources: [{ title: "JS Info", link: "https://javascript.info" }] },
                    { id: "dom", label: "DOM Manipulation", type: "sub", parent: "js", desc: "Interacting with page elements." },
                    { id: "fetch", label: "Fetch API / AJAX", type: "sub", parent: "js", desc: "Async data loading." },
                    { id: "react", label: "React framework", type: "framework", parent: "js", desc: "Component based architecture." },
                    { id: "hooks", label: "React Hooks", type: "sub", parent: "react", desc: "useState, useEffect, etc." },
                    { id: "git", label: "Version Control", type: "tool", parent: "js", desc: "Git & GitHub basics." },
                    { id: "deploy", label: "Deployment", type: "tool", parent: "git", desc: "Vercel, Netlify, CI/CD." }
                ]
            },
            backend: {
                id: "backend",
                title: "Backend Developer",
                description: "Architect the server-side logic and databases.",
                nodes: [
                    { id: "os", label: "OS & Terminal", type: "root", status: "unlocked", desc: "Linux basics and command line." },
                    { id: "lang", label: "Pick a Language", type: "main", parent: "os", desc: "Node.js, Python, or Go." },
                    { id: "repo", label: "Git Repo", type: "tool", parent: "lang", desc: "Code management." },
                    { id: "db-rel", label: "Relational DBs", type: "main", parent: "lang", desc: "PostgreSQL, MySQL." },
                    { id: "db-nosql", label: "NoSQL DBs", type: "main", parent: "lang", desc: "MongoDB, Redis." },
                    { id: "api", label: "API Design", type: "main", parent: "lang", desc: "REST & GraphQL." },
                    { id: "auth", label: "Authentication", type: "sub", parent: "api", desc: "JWT, OAuth, Cookies." },
                    { id: "caching", label: "Caching", type: "sub", parent: "api", desc: "Redis, CDN." },
                    { id: "security", label: "Security", type: "sub", parent: "api", desc: "OWASP Top 10." },
                    { id: "scale", label: "Scaling", type: "root", parent: "api", desc: "Load Balancers, Microservices." }
                ]
            }
        };

        const RoadmapRenderer = ({ roadmapId, onBack, userProgress, updateUserProgress }) => {
            const { motion, AnimatePresence } = window.Motion;
            const data = ROADMAP_MASTER_DATA[roadmapId];
            const [selectedNode, setSelectedNode] = useState(null);

            const isCompleted = (id) => userProgress[roadmapId]?.includes(id);
            const toggleComplete = (id) => {
                const current = userProgress[roadmapId] || [];
                const next = current.includes(id) ? current.filter(x => x !== id) : [...current, id];
                updateUserProgress(roadmapId, next);
            };

            return (
                <div className="h-full flex flex-col animate-fade-in relative">
                    <div className="flex items-center gap-4 mb-6 border-b border-white/5 pb-4 shrink-0">
                        <button onClick={onBack} className="p-2 hover:bg-white/5 rounded-lg text-slate-400 hover:text-white transition-colors"><Icon name="arrow-left" /></button>
                        <div>
                            <h2 className="text-2xl font-bold text-white">{data.title}</h2>
                            <p className="text-xs text-slate-500 font-mono">ROADMAP ENGINE v1.0</p>
                        </div>
                    </div>

                    <div className="flex-1 overflow-y-auto relative custom-scrollbar pb-20">
                        {/* Vertical Spine */}
                        <div className="absolute left-6 top-4 bottom-4 w-1 bg-white/5 rounded-full z-0"></div>

                        <div className="space-y-8 pl-14 pr-4">
                            {data.nodes.map((node, idx) => {
                                const done = isCompleted(node.id);
                                const isNext = !done && (!node.parent || isCompleted(node.parent));
                                const isLocked = !done && !isNext;

                                return (
                                    <div key={node.id} className="relative group">
                                        {/* Connector Dot */}
                                        <div className={`absolute -left-[38px] top-6 w-4 h-4 rounded-full border-2 transition-all z-10 ${done ? 'bg-emerald-500 border-emerald-500 shadow-[0_0_10px_rgba(16,185,129,0.5)]' :
                                            isNext ? 'bg-black border-brand-400 animate-pulse' :
                                                'bg-black border-slate-700'
                                            }`}></div>

                                        <div
                                            onClick={() => !isLocked && setSelectedNode(node)}
                                            className={`relative p-5 rounded-xl border transition-all cursor-pointer ${done ? 'bg-emerald-900/10 border-emerald-500/30' :
                                                isNext ? 'bg-brand-500/5 border-brand-500/50 hover:bg-brand-500/10 shadow-[0_0_20px_rgba(var(--brand-500),0.1)]' :
                                                    'bg-white/5 border-white/5 opacity-50 grayscale hover:opacity-75'
                                                }`}
                                        >
                                            <div className="flex justify-between items-start">
                                                <div>
                                                    <span className={`text-[10px] font-bold uppercase tracking-widest px-2 py-0.5 rounded mb-2 inline-block ${node.type === 'root' ? 'bg-pink-500/20 text-pink-400' :
                                                        node.type === 'framework' ? 'bg-cyan-500/20 text-cyan-400' :
                                                            'bg-white/10 text-slate-400'
                                                        }`}>{node.type}</span>
                                                    <h3 className="text-lg font-bold text-white mb-1">{node.label}</h3>
                                                    <p className="text-sm text-slate-400">{node.desc}</p>
                                                </div>
                                                {done && <Icon name="check-circle" className="text-emerald-500" />}
                                            </div>
                                        </div>
                                    </div>
                                )
                            })}
                        </div>
                    </div>

                    {/* Detail Drawer */}
                    <AnimatePresence>
                        {selectedNode && (
                            <motion.div
                                initial={{ x: "100%" }} animate={{ x: 0 }} exit={{ x: "100%" }}
                                className="absolute inset-y-0 right-0 w-full md:w-96 bg-[#05050a] border-l border-white/10 shadow-2xl z-50 p-6 overflow-y-auto"
                                onClick={(e) => e.stopPropagation()}
                            >
                                <button onClick={() => setSelectedNode(null)} className="mb-6 text-slate-400 hover:text-white"><Icon name="x" /></button>

                                <h2 className="text-2xl font-bold text-white mb-2">{selectedNode.label}</h2>
                                <p className="text-slate-400 text-sm leading-relaxed mb-6">{selectedNode.desc}</p>

                                <div className="space-y-6">
                                    <button
                                        onClick={() => { toggleComplete(selectedNode.id); setSelectedNode(null); }}
                                        className={`w-full py-3 rounded-xl font-bold uppercase tracking-widest text-xs border transition-all ${isCompleted(selectedNode.id)
                                            ? 'border-emerald-500 text-emerald-400 hover:bg-emerald-500/10'
                                            : 'bg-brand-600 border-transparent text-white hover:bg-brand-500 shadow-[0_0_20px_rgba(var(--brand-500),0.4)]'
                                            }`}
                                    >
                                        {isCompleted(selectedNode.id) ? 'Mark Incomplete' : 'Mark as Done'}
                                    </button>

                                    {selectedNode.resources && (
                                        <div>
                                            <h4 className="text-xs font-bold text-brand-400 uppercase tracking-widest mb-3">Resources</h4>
                                            <div className="space-y-2">
                                                {selectedNode.resources.map((r, i) => (
                                                    <a key={i} href={r.link} target="_blank" className="block p-3 bg-white/5 rounded-lg border border-white/5 hover:border-brand-500/30 text-sm text-slate-300 hover:text-white transition-colors">
                                                        <div className="flex items-center justify-between">
                                                            <span>{r.title}</span>
                                                            <Icon name="external-link" size={12} />
                                                        </div>
                                                    </a>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    <div className="p-4 rounded-xl bg-purple-500/10 border border-purple-500/20">
                                        <h4 className="flex items-center gap-2 text-xs font-bold text-purple-400 uppercase tracking-widest mb-2"><Icon name="zap" size={14} /> Project Idea</h4>
                                        <p className="text-xs text-purple-200">Build a mini-demo using {selectedNode.label} concepts to verify your learning.</p>
                                    </div>
                                </div>
                            </motion.div>
                        )}
                    </AnimatePresence>
                </div>
            );
        };

        const RoadmapHub = ({ user, update }) => {
            const [view, setView] = useState('hub');
            const [activeId, setActiveId] = useState(null);

            const updateProgress = (mapId, progress) => {
                update({ ...user, roadmapProgress: { ...(user.roadmapProgress || {}), [mapId]: progress } });
            };

            if (view === 'roadmap' && activeId) {
                return (
                    <RoadmapRenderer
                        roadmapId={activeId}
                        onBack={() => setView('hub')}
                        userProgress={user.roadmapProgress || {}}
                        updateUserProgress={updateProgress}
                    />
                );
            }

            return (
                <div className="space-y-8 animate-fade-in">
                    <div className="flex items-end justify-between border-b border-white/5 pb-6">
                        <div>
                            <h2 className="text-4xl font-bold text-white tracking-tight">Roadmap Engine</h2>
                            <p className="text-slate-400 mt-2 font-mono text-xs">CHOOSE YOUR CAREER PATHWAY</p>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {Object.values(ROADMAP_MASTER_DATA).map(map => (
                            <div
                                key={map.id}
                                onClick={() => { setActiveId(map.id); setView('roadmap'); }}
                                className="group relative h-64 bg-[#0a0a0f] border border-white/10 rounded-2xl overflow-hidden cursor-pointer hover:border-brand-500/50 transition-all duration-300 hover:shadow-[0_0_30px_rgba(var(--brand-500),0.15)]"
                            >
                                <div className="absolute inset-0 bg-gradient-to-br from-brand-500/5 to-transparent group-hover:from-brand-500/10 transition-colors"></div>
                                <div className="absolute bottom-0 left-0 right-0 h-1/2 bg-gradient-to-t from-black to-transparent"></div>

                                <div className="absolute inset-0 p-6 flex flex-col justify-end">
                                    <div className="mb-4 w-12 h-12 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center group-hover:scale-110 transition-transform text-brand-400">
                                        <Icon name="map" />
                                    </div>
                                    <h3 className="text-xl font-bold text-white mb-1">{map.title}</h3>
                                    <p className="text-sm text-slate-400 line-clamp-2">{map.description}</p>

                                    <div className="mt-4 flex items-center gap-2 text-xs font-mono text-brand-400 opacity-0 group-hover:opacity-100 transition-opacity translate-y-2 group-hover:translate-y-0 duration-300">
                                        INITIALIZE PROTOCOL <Icon name="arrow-right" size={12} />
                                    </div>
                                </div>
                            </div>
                        ))}

                        {/* Coming Soon Card */}
                        <div className="h-64 border border-white/5 border-dashed rounded-2xl flex flex-col items-center justify-center text-slate-600 gap-4">
                            <Icon name="lock" size={24} />
                            <span className="text-xs font-bold uppercase tracking-widest">More Paths Locked</span>
                        </div>
                    </div>
                </div>
            );
        };

        /* --- GHOST PROTOCOL (PANIC MODE) --- */
        const GhostProtocol = ({ exit }) => {
            const [toast, setToast] = useState(false);
            useEffect(() => { setTimeout(() => setToast(true), 100); const t = setTimeout(() => setToast(false), 4000); return () => clearTimeout(t); }, []);

            return (
                <div className="fixed inset-0 z-[100] bg-black font-mono text-green-500 overflow-hidden flex flex-col items-center justify-center p-6 animate-fade-in">
                    <div className={`absolute top-6 right-6 bg-green-900/20 border border-green-500/50 p-4 rounded-lg shadow-[0_0_30px_rgba(0,255,0,0.2)] flex items-center gap-4 transition-all duration-500 transform ${toast ? 'translate-x-0 opacity-100' : 'translate-x-full opacity-0'}`}>
                        <div className="p-2 bg-green-500/20 rounded-full animate-pulse"><Icon name="shield" size={20} /></div>
                        <div><div className="font-bold text-xs uppercase tracking-[0.2em] mb-1">Ghost Protocol</div><div className="text-[10px] opacity-70">Visual footprint minimized.</div></div>
                    </div>
                    <div className="absolute inset-0 pointer-events-none opacity-20" style={{ backgroundImage: 'linear-gradient(0deg, transparent 24%, rgba(0, 255, 0, .3) 25%, rgba(0, 255, 0, .3) 26%, transparent 27%, transparent 74%, rgba(0, 255, 0, .3) 75%, rgba(0, 255, 0, .3) 76%, transparent 77%, transparent), linear-gradient(90deg, transparent 24%, rgba(0, 255, 0, .3) 25%, rgba(0, 255, 0, .3) 26%, transparent 27%, transparent 74%, rgba(0, 255, 0, .3) 75%, rgba(0, 255, 0, .3) 76%, transparent 77%, transparent)', backgroundSize: '50px 50px' }}></div>
                    <h1 className="text-4xl md:text-6xl font-black mb-12 tracking-tighter animate-pulse border-b-4 border-green-500 pb-4 text-center">GHOST PROTOCOL</h1>
                    <div className="max-w-3xl w-full border-l-4 border-green-500 pl-8 relative z-10">
                        <h2 className="text-xl font-bold mb-6 underline decoration-double text-white">EMERGENCY DATA DUMP</h2>
                        <ul className="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-4 text-lg">
                            {["Reverse Linked List", "ACID Properties", "OSI Model Layers", "Dijkstra's Algorithm", "Normalization (1NF-3NF)", "TCP vs UDP", "Binary Search Tree", "Deadlock Conditions", "OOP Concepts", "SQL Joins", "Page Replacement Algos", "Scheduling Algos", "CAP Theorem", "Hash Tables", "Knapsack (DP)", "BFS / DFS", "Virtual Memory", "REST API", "Git Basics", "JWT Auth"].map((t, i) => <li key={i} className="flex gap-4 items-center"><span className="text-xs opacity-50">{String(i + 1).padStart(2, '0')}</span> <span className="hover:bg-green-500/20 cursor-crosshair px-2 transition-all rounded">{t}</span></li>)}
                        </ul>
                    </div>
                    <button onClick={exit} className="mt-16 px-8 py-3 bg-transparent border-2 border-green-500 text-green-500 font-bold hover:bg-green-500 hover:text-black transition-all uppercase tracking-[0.2em] shadow-[0_0_20px_rgba(0,255,0,0.3)] relative z-10 rounded">Deactivate Protocol</button>
                </div>
            );
        };

        /* --- MAIN APP SHELL --- */
        const MainApp = ({ session }) => {
            const { motion, AnimatePresence } = window.Motion;
            const [cmdOpen, setCmdOpen] = useState(false);
            const [panicMode, setPanicMode] = useState(false);
            const [tab, setTab] = useState('dashboard');
            const [mobileOpen, setMobileOpen] = useState(false);
            const [cortexOpen, setCortexOpen] = useState(true);
            const [isExpanded, setIsExpanded] = useState(true);


            // KEY GEN
            const storageKey = session?.user?.id ? `velosify_user_${session.user.id}` : 'velosify_guest';

            const [data, setData] = useState(() => {
                const base = { themeColor: 'violet', goalName: 'GATE 2026', examDate: '2026-02-01', totalTime: 0, syllabus: [], kanban: { todo: [], doing: [], done: [] }, flashcards: [], resources: [], dsa: [], focus: { timeLeft: 1500, initialTime: 1500, isActive: false }, roadmapProgress: {} };
                const s = localStorage.getItem(storageKey);
                if (s) {
                    try {
                        const parsed = JSON.parse(s);
                        return { ...base, ...parsed, focus: { ...base.focus, ...(parsed.focus || {}) } };
                    } catch (e) { return base; }
                }
                return base;
            });

            // DATA PERSISTENCE
            useEffect(() => { localStorage.setItem(storageKey, JSON.stringify(data)); }, [data, storageKey]);

            // Theme Engine
            useEffect(() => {
                const r = document.documentElement;
                const t = { violet: ['99 102 241', '79 70 229', '129 140 248'], cyan: ['6 182 212', '8 145 178', '34 211 238'], emerald: ['16 185 129', '5 150 105', '52 211 153'], rose: ['244 63 94', '225 29 72', '251 113 133'] };
                const c = t[data.themeColor] || t.violet;
                r.style.setProperty('--brand-500', c[0]); r.style.setProperty('--brand-600', c[1]); r.style.setProperty('--brand-400', c[2]);
            }, [data.themeColor]);

            // Focus Timer Global
            useEffect(() => {
                let i; if (data.focus.isActive && data.focus.timeLeft > 0) {
                    i = setInterval(() => setData(d => {
                        if (d.focus.timeLeft <= 0) return { ...d, focus: { ...d.focus, isActive: false }, totalTime: d.totalTime + (d.focus.initialTime / 60) };
                        return { ...d, focus: { ...d.focus, timeLeft: d.focus.timeLeft - 1 } };
                    }), 1000);
                } return () => clearInterval(i);
            }, [data.focus.isActive]);

            // Command Palette
            useEffect(() => {
                const handleKeyDown = (e) => {
                    if ((e.ctrlKey || e.metaKey) && e.key === 'k') { e.preventDefault(); setCmdOpen(p => !p); }
                    if (e.key === 'Escape') setCmdOpen(false);
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, []);

            const log = () => setData(d => ({ ...d, totalTime: d.totalTime + 1 }));
            const logout = async () => { await window.sb.auth.signOut(); window.location.reload(); };
            const resetData = () => { if (confirm("This will include your saved data.")) { localStorage.removeItem(storageKey); window.location.reload(); } };

            return (
                <div className="relative h-screen w-screen overflow-hidden bg-[#05050a]">
                    {panicMode && <GhostProtocol exit={() => setPanicMode(false)} />}
                    <div className={`flex h-screen overflow-hidden font-sans text-slate-200 transition-all duration-700 ${panicMode ? 'opacity-0 scale-95 blur-sm brightness-50 pointer-events-none' : 'opacity-100 scale-100'}`}>
                        {/* Command Palette Modal */}
                        {cmdOpen && (
                            <div className="fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-start justify-center pt-32 animate-fade-in" onClick={() => setCmdOpen(false)}>
                                <div className="w-full max-w-2xl bg-surface-900 border border-white/10 rounded-xl shadow-2xl overflow-hidden" onClick={e => e.stopPropagation()}>
                                    <div className="flex items-center gap-4 p-4 border-b border-white/5">
                                        <Icon name="search" className="text-slate-400" />
                                        <input autoFocus placeholder="Jump to module..." className="flex-1 bg-transparent border-none outline-none text-white font-medium"
                                            onKeyDown={e => {
                                                if (e.key === 'Enter') {
                                                    const val = e.target.value.toLowerCase();
                                                    if (val.includes('dsa')) setTab('dsa');
                                                    else if (val.includes('vault') || val.includes('res')) setTab('resources');
                                                    else if (val.includes('focus')) setTab('focus');
                                                    else if (val.includes('dash')) setTab('dashboard');
                                                    setCmdOpen(false);
                                                }
                                            }}
                                        />
                                        <div className="text-[10px] font-mono text-slate-500 bg-white/5 px-2 py-1 rounded">ESC</div>
                                    </div>
                                    <div className="p-2">
                                        <div className="text-[10px] font-bold text-slate-500 uppercase tracking-widest px-3 py-2">Quick Navigation</div>
                                        {[
                                            { id: 'dashboard', l: 'Dashboard', i: 'layout-dashboard' },
                                            { id: 'dsa', l: 'DSA Tracker', i: 'code' },
                                            { id: 'resources', l: 'Data Vault', i: 'lock' },
                                            { id: 'focus', l: 'Focus Engine', i: 'zap' }
                                        ].map(x => (
                                            <button key={x.id} onClick={() => { setTab(x.id); setCmdOpen(false); }} className="w-full flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-white/5 text-slate-300 hover:text-white transition-colors text-sm text-left">
                                                <Icon name={x.i} size={16} /> {x.l}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Mobile Backdrop */}
                        {mobileOpen && <div className="fixed inset-0 z-40 bg-black/80 backdrop-blur-sm lg:hidden" onClick={() => setMobileOpen(false)}></div>}

                        {/* Sidebar */}
                        <aside className={`fixed inset-y-0 left-0 z-50 bg-surface-900/95 backdrop-blur-xl border-r border-white/5 flex flex-col transition-all duration-300 ease-in-out lg:static lg:translate-x-0 ${mobileOpen ? 'translate-x-0 shadow-2xl w-64' : '-translate-x-full w-64'} ${isExpanded ? 'lg:w-64' : 'lg:w-20'}`}>
                            <div className={`p-6 md:p-8 flex items-center justify-between gap-3 ${!isExpanded && 'lg:justify-center lg:px-2'}`}>
                                <div className="flex items-center gap-3">
                                    <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-brand-600 to-brand-500 flex items-center justify-center text-white font-bold text-xl shadow-[0_0_20px_rgba(var(--brand-500),0.4)] flex-shrink-0">V</div>
                                    <span className={`font-bold text-xl tracking-tighter text-white transition-opacity duration-300 ${!isExpanded && 'lg:opacity-0 lg:w-0 lg:hidden'}`}>VELOSIFY</span>
                                </div>
                                <button onClick={() => setMobileOpen(false)} className="lg:hidden text-slate-400 hover:text-white"><Icon name="x" size={24} /></button>
                                <button onClick={() => setIsExpanded(!isExpanded)} className={`hidden lg:block text-slate-400 hover:text-white transition-transform ${!isExpanded && 'rotate-180'}`}>
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                                </button>
                            </div>
                            <nav className="flex-1 px-3 space-y-1 mt-2 overflow-y-auto custom-scrollbar">
                                {/* MAIN LINKS */}
                                {[
                                    { id: 'dashboard', i: 'layout-dashboard', l: 'Dashboard' },
                                    { id: 'roadmaps', i: 'map', l: 'Roadmaps' },
                                    { id: 'dsa', i: 'code', l: 'DSA Tracker' },
                                    { id: 'syllabus', i: 'book-open', l: 'Syllabus' }
                                ].map(x => (
                                    <button key={x.id} onClick={() => { setTab(x.id); setMobileOpen(false); }} className={`w-full flex items-center gap-4 px-4 py-3.5 rounded-xl transition-all group relative overflow-hidden ${tab === x.id ? 'text-white bg-white/5 shadow-inner' : 'text-slate-400 hover:text-white hover:bg-white/5'} ${!isExpanded && 'lg:justify-center'}`}>
                                        {tab === x.id && <div className="absolute left-0 top-1/2 -translate-y-1/2 h-6 w-1 bg-brand-500 rounded-r-full shadow-[0_0_10px_rgba(var(--brand-500),0.8)]"></div>}
                                        <Icon name={x.i} size={18} className={tab === x.id ? "text-brand-400" : ""} />
                                        <span className={`text-xs font-medium transition-all duration-300 ${!isExpanded && 'lg:hidden'}`}>{x.l}</span>
                                    </button>
                                ))}

                                {/* THE CORTEX GROUP */}
                                <div className="mt-4 mb-2">
                                    <button onClick={() => isExpanded && setCortexOpen(!cortexOpen)} className={`w-full flex items-center justify-between px-4 py-2 text-[10px] font-bold uppercase tracking-widest text-slate-500 hover:text-brand-400 transition-colors ${!isExpanded && 'lg:justify-center'}`}>
                                        <div className="flex items-center gap-3">
                                            <Icon name="brain-circuit" size={16} />
                                            <span className={!isExpanded ? 'lg:hidden' : ''}>THE CORTEX</span>
                                        </div>
                                        {isExpanded && <Icon name={cortexOpen ? "chevron-down" : "chevron-right"} size={12} />}
                                    </button>

                                    <AnimatePresence>
                                        {(cortexOpen || !isExpanded) && (
                                            <motion.div
                                                initial={{ height: 0, opacity: 0 }}
                                                animate={{ height: "auto", opacity: 1 }}
                                                exit={{ height: 0, opacity: 0 }}
                                                className="overflow-hidden space-y-1"
                                            >
                                                {[
                                                    { id: 'flashcards', i: 'zap', l: 'Neural Flashcards' },
                                                    { id: 'resources', i: 'lock', l: 'Data Vault' },
                                                    { id: 'projects', i: 'trello', l: 'Task Manager' }
                                                ].map(x => (
                                                    <button key={x.id} onClick={() => { setTab(x.id); setMobileOpen(false); }} className={`w-full flex items-center gap-4 px-4 py-3 rounded-xl transition-all group relative overflow-hidden ${tab === x.id ? 'text-white bg-white/5 shadow-inner' : 'text-slate-400 hover:text-white hover:bg-white/5'} ${!isExpanded ? 'lg:justify-center' : 'pl-10'}`}>
                                                        {tab === x.id && <div className="absolute left-0 top-1/2 -translate-y-1/2 h-4 w-1 bg-brand-500 rounded-r-full shadow-[0_0_10px_rgba(var(--brand-500),0.8)]"></div>}
                                                        <Icon name={x.i} size={16} className={tab === x.id ? "text-brand-400" : ""} />
                                                        <span className={`text-xs font-medium transition-all duration-300 ${!isExpanded && 'lg:hidden'}`}>{x.l}</span>
                                                    </button>
                                                ))}
                                            </motion.div>
                                        )}
                                    </AnimatePresence>
                                </div>

                                {/* SYSTEM LINKS */}
                                {[
                                    { id: 'focus', i: 'clock', l: 'Focus Engine' },
                                    { id: 'settings', i: 'settings', l: 'System' }
                                ].map(x => (
                                    <button key={x.id} onClick={() => { setTab(x.id); setMobileOpen(false); }} className={`w-full flex items-center gap-4 px-4 py-3.5 rounded-xl transition-all group relative overflow-hidden ${tab === x.id ? 'text-white bg-white/5 shadow-inner' : 'text-slate-400 hover:text-white hover:bg-white/5'} ${!isExpanded && 'lg:justify-center'}`}>
                                        {tab === x.id && <div className="absolute left-0 top-1/2 -translate-y-1/2 h-6 w-1 bg-brand-500 rounded-r-full shadow-[0_0_10px_rgba(var(--brand-500),0.8)]"></div>}
                                        <Icon name={x.i} size={18} className={tab === x.id ? "text-brand-400" : ""} />
                                        <span className={`text-xs font-medium transition-all duration-300 ${!isExpanded && 'lg:hidden'}`}>{x.l}</span>
                                    </button>
                                ))}
                            </nav>
                            <div className="p-6 border-t border-white/5">
                                <div className="flex items-center gap-3 mb-4">
                                    <div className="w-8 h-8 rounded-full bg-brand-500/20 text-brand-400 flex items-center justify-center font-bold text-xs border border-brand-500/30 flex-shrink-0">
                                        {(session.user.email || 'U').charAt(0).toUpperCase()}
                                    </div>
                                    <div className={`overflow-hidden transition-all duration-300 ${!isExpanded && 'lg:hidden'}`}><div className="text-xs font-bold text-white truncate w-24">{session.user.email}</div><div className="text-[10px] text-emerald-400 uppercase tracking-wider font-bold"> Online</div></div>
                                </div>
                                <button onClick={logout} className={`w-full py-2.5 flex items-center justify-center gap-2 text-[10px] font-bold text-slate-500 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors border border-transparent hover:border-red-500/20 tracking-widest ${!isExpanded && 'lg:px-0'}`}><Icon name="log-out" size={14} /> <span className={!isExpanded ? 'lg:hidden' : ''}>DISCONNECT</span></button>
                                <button onClick={() => setPanicMode(true)} className={`w-full mt-3 py-2.5 flex items-center justify-center gap-2 text-[10px] font-bold text-red-500 bg-red-500/10 border border-red-500/30 hover:bg-red-500 hover:text-white rounded-lg transition-all tracking-widest animate-pulse ${!isExpanded && 'lg:px-0'}`}><Icon name="siren" size={14} /> <span className={!isExpanded ? 'lg:hidden' : ''}>GHOST PROTOCOL</span></button>
                            </div>
                        </aside>

                        <main className="flex-1 overflow-y-auto relative z-10 flex flex-col">
                            {/* Mobile Header */}
                            <header className="lg:hidden p-4 border-b border-white/5 flex items-center justify-between bg-surface-900/50 backdrop-blur-md sticky top-0 z-30">
                                <div className="flex items-center gap-3">
                                    <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-brand-600 to-brand-500 flex items-center justify-center text-white font-bold text-xl shadow-[0_0_20px_rgba(var(--brand-500),0.4)]">V</div>
                                    <span className="font-bold text-lg tracking-tight text-white">VELOSIFY</span>
                                </div>
                                <button onClick={() => setMobileOpen(true)} className="p-2 text-slate-300 hover:text-white transition-colors">
                                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                                </button>
                            </header>

                            <div className="p-6 lg:p-10 max-w-7xl mx-auto min-h-full w-full">
                                {tab === 'dashboard' && <Dashboard user={data} setTab={setTab} />}
                                {tab === 'focus' && <FocusMode focus={data.focus} setFocus={f => setData(d => ({ ...d, focus: (typeof f === 'function' ? f(d.focus) : f) }))} />}
                                {tab === 'roadmaps' && <RoadmapHub user={data} update={setData} />}
                                {tab === 'syllabus' && <Syllabus user={data} update={setData} log={log} />}
                                {tab === 'projects' && <Kanban user={data} update={setData} log={log} />}
                                {tab === 'flashcards' && <Flashcards user={data} update={setData} log={log} />}
                                {tab === 'resources' && <Vault user={data} update={setData} setTab={setTab} />}
                                {tab === 'dsa' && <DSATracker user={data} update={setData} log={log} />}
                                {tab === 'hr-prep' && <HRPrep user={data} update={setData} log={log} />}
                                {tab === 'settings' && <Settings user={data} update={setData} reset={resetData} />}
                            </div>
                        </main>
                    </div>
                </div>
            );
        };

        const Root = () => {
            const [ready, setReady] = useState(false);
            const [session, setSession] = useState(null);
            const [showAuth, setShowAuth] = useState(false);

            useEffect(() => {
                const check = () => { if (window.__SESSION__ !== undefined) { setSession(window.__SESSION__); setReady(true); } };
                check();
                const onAuth = (_e, s) => { setSession(s); setReady(true); };
                const { data: { subscription } } = window.sb.auth.onAuthStateChange(onAuth);
                window.addEventListener('velosify-ready', check);
                return () => { subscription.unsubscribe(); window.removeEventListener('velosify-ready', check); }
            }, []);

            if (!ready && window.__SESSION__ === undefined) return null;

            if (session) return <MainApp key={session.user.id} session={session} />;

            return (
                <>
                    <LandingPage onLogin={() => setShowAuth(true)} />
                    {showAuth && <AuthModal onClose={() => setShowAuth(false)} />}
                </>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Root />);
    </script>
</body>

</html>